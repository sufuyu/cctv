!function(e){function t(i){if(r[i])return r[i].exports;var a=r[i]={exports:{},id:i,loaded:!1};return e[i].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){var i;i=function(e,t,i){function a(e,t,r,i,a){if(!p.dataVideo)throw"this browser not support data mode playBack!";_=e,T=t,g.logTarget=r,D.uuid=i,a?(D.mobile=!0,D.upLoad=!1,S.videoMaxSize=41943040):(D.mobile=!1,D.upLoad=!0),b.init(_,n),g.info(" ---- init H5 QPlayer  version : "+S.version+" ---- ")}function n(e,t,r){_&&T&&T.call(this,e,t,r)}function s(e){g.info(" ---- setLoad : "+e.toString()+" ---- "),D.loading=e}function o(e){g.info(" ---- reset PlayBackList "+(e?"on":"off")+" ---- "),_=e,k=!0,b.reset(_)}function h(){try{_&&!k&&b.run()}catch(e){g.error("TryCatch error : "+e.message),g.error("TryCatch error : "+e.stack)}w&&Date.now()-I>1e3&&(I=Date.now(),console.log(b.log)),setTimeout(h,S.checkerInterval)}function c(e,t,r,i){if(_){var a=e;if(t){v.addPBItem(y.change_definition),g.info(" ---- freshFragments in smooth segmentInfo order : "+r+" , time : "+i),b.freshFragments(a);var n=r,s=i+b.encodeBuffer,o=a[n];if(s+200>o.showEndTime&&n<a.length-1){var h=s+200-o.showEndTime;n+=1,o=a[n],s=o.showStartTime+h}b.seek(n,s,!1)}else g.info(" ---- freshFragments segmentInfo ---- "),k=!0,b.freshFragments(a)}}function u(e,t,r){_&&(e.length&&g.info(" ---- addFragment order : "+t+" , time : "+r+" , count : "+e.length),b.addFragment(e,t,r))}function l(e,t){_&&(g.info(" ---- removeFragment start : "+e+" , len : "+t),b.removeFragment(e,t))}function d(e,t,r){_&&(g.info(" ---- seek order : "+e+" , time : "+t+" ---- "),n(m.playState_seeking),b.seek(e,t,!0,!1,r&&1==r.jump),k=!1)}function f(){clearTimeout(L),L=0,C!=-1&&P!=-1&&(d(P,C,E),C=-1,P=-1,E=null)}var p=r(1),g=r(2),m=(r(3),r(4)),v=r(5),y=r(12),S=r(8),b=r(14),D=r(6),T=null,_=null,k=!0,w=!1,I=-1,P=-1,C=-1,L=0,E=null;window.p2p=window.QIYI_HTML5_P2P_PlayBack_0001={init:a,setLoad:s,freshFragments:c,reset:o,seek:function(e,t,r){0==L||r&&1==r.run?(d(e,t,r),clearTimeout(L),L=0,L=setTimeout(f,500)):(P=e,C=t,E=r)},resume:function(){_&&b.resume()},pause:function(){_&&b.pause()},addFragment:u,removeFragment:l,get playInfo(){return _?b.playInfo:null},get bufferInfo(){return _?b.bufferInfo:null},get eof(){return!!_&&b.eof},get done(){return!!_&&b.done},get fragments(){return b.fragments},get version(){return S.version},get p2plog(){return w=!w}},h()}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,r){var i=self.navigator.userAgent.toLowerCase(),a=/(edge)\/([\w.]+)/.exec(i)||/(opr)[\/]([\w.]+)/.exec(i)||/(chrome)[ \/]([\w.]+)/.exec(i)||/(iemobile)[\/]([\w.]+)/.exec(i)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(i)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(i)||/(webkit)[ \/]([\w.]+)/.exec(i)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(i)||/(msie) ([\w.]+)/.exec(i)||i.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(i)||i.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(i)||[],n=/(ipad)/.exec(i)||/(ipod)/.exec(i)||/(windows phone)/.exec(i)||/(iphone)/.exec(i)||/(kindle)/.exec(i)||/(android)/.exec(i)||/(windows)/.exec(i)||/(mac)/.exec(i)||/(linux)/.exec(i)||/(cros)/.exec(i)||[],s={browser:a[5]||a[3]||a[1]||"",version:a[2]||a[4]||"0",majorVersion:a[4]||a[2]||"0",platform:n[0]||""},o={};if(s.browser){o[s.browser]=!0;var h=s.majorVersion.split(".");o.version={major:parseInt(s.majorVersion,10),string:s.version},h.length>1&&(o.version.minor=parseInt(h[1],10)),h.length>2&&(o.version.build=parseInt(h[2],10))}if(s.platform&&(o[s.platform]=!0),(o.chrome||o.opr||o.safari)&&(o.webkit=!0),o.rv||o.iemobile){o.rv&&delete o.rv;var c="msie";s.browser=c,o[c]=!0}if(o.edge){delete o.edge;var u="msedge";s.browser=u,o[u]=!0}if(o.opr){var l="opera";s.browser=l,o[l]=!0}if(o.safari&&o.android){var d="android";s.browser=d,o[d]=!0}o.name=s.browser,o.platform=s.platform,o.chrome&&o.version&&o.version.major<=44&&(Uint8Array.prototype.slice=function(e,t){return new Uint8Array(this.subarray(e,t))}),window.WebSocket=window.webSocket||window.WebSocket,window.URL=window.URL||window.webkitURL,window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription,window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,window.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate;var f=!0;return{get supportFetch(){return window.fetch&&!o.msedge},get forceFirstIDR(){return f},get dataVideo(){return window.MediaSource&&window.URL&&window.WebSocket},get p2p(){return window.RTCSessionDescription&&window.RTCPeerConnection&&window.RTCIceCandidate}}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,r){function i(){var e=new Date;return(e.getHours()>=10?e.getHours():"0"+e.getHours())+":"+(e.getMinutes()>=10?e.getMinutes().toString():"0"+e.getMinutes())+":"+(e.getSeconds()>=10?e.getSeconds().toString():"0"+e.getSeconds())}var a=null;return{debug:function(e){a?a.debug("__PB__ "+e):console.log("__PB__"+i+"__ "+e)},log:function(e){a?a.log("__PB__ "+e):console.log("__PB__"+i+"__ "+e)},info:function(e){a?a.info("__PB__ "+e):console.log("__PB__"+i+"__ "+e)},warn:function(e){a?a.warn("__PB__ "+e):console.log("__PB__"+i+"__ "+e)},error:function(e){a?a.error("__PB__ "+e):console.log("__PB__"+i+"__ "+e)},set logTarget(e){a=e}}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(){function e(e,t){var r="";if(e.length<=t){for(r=e;r.length<t;)r+="0";return r}var i=Math.floor(e.length/t);(t-1)*(i+1)+1<=e.length&&(i+=1);for(var a=0;r.length<t;)r+=e[a],a+=i;return r}function t(e){var t,r=0;t=e.length>8?e.slice(0,8):e;for(var i=0;i<t.length;i++)switch(i){case 0:var a=72057594037927940*("0x"+t[i]);r+=a;break;case 1:var n=281474976710656*("0x"+t[i]);r+=n;break;case 2:var s=1099511627776*("0x"+t[i]);r+=s;break;case 3:var o=4294967296*("0x"+t[i]);r+=o;break;case 4:var h=16777216*("0x"+t[i]);r+=h;break;case 5:var c=65536*("0x"+t[i]);r+=c;break;case 6:var u=256*("0x"+t[i]);r+=u;break;case 7:var l=1*("0x"+t[i]);r+=l}return r}function r(e){var t=/(\w+):\/\/([^\/:]+):?(\d*)((?:\/|$)[^?#]*)/,r=e.match(t);return r?r[2]:""}function i(e){var t=e.match(/[a-z|A-Z]/g);return!!(t&&t.length>0)}function a(e,t,r){for(var i="",a=0;a<r;a++){var n=e[t+a];if(void 0==n)break;i+=(n<16?"0"+n.toString(16):n.toString(16))+"-"}return i}function n(e,t,r){for(var i="",a=0;a<r;a++){var n=e[t+a];if(void 0==n)break;i+=n.toString(10)+"-"}return i}function s(e,t,r,i){for(var a=0;a<i;a++)a>=r.length?e[t+a]=0:e[t+a]=r.charCodeAt(a)}function o(e,t,r,i){for(var a=r,n=t,s=i;s>4;)o(e,n,Math.floor(a/4294967296),s-4),a%=4294967296,n+=s-4,s-=s-4;for(var h=0;h<s;)e[n+h]=a/(1<<8*(s-h-1)),h++}function h(e,t,r,i){function a(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function n(e,t){var r;for(r in e)if(a(e,r)&&t(e[r],r))break}return t&&n(t,function(t,n){!r&&a(e,n)||(i&&"string"!=typeof t&&"boolean"!=typeof t?(e[n]||(e[n]={}),h(e[n],t,r,i)):e[n]=t)}),e}function c(e,t){if("string"==typeof t&&e){var r=new Image;r.onload=r.onerror=r.onabort=function(){r.onload=r.onerror=r.onabort=null,r=null};var i=[];e.dur=+new Date;for(var a in e)i.push(a+"="+encodeURIComponent(e[a]));r.src=t+"?"+i.join("&")}}return{fireUrl:c,mixin:h,strToNumber:t,sliceStr:e,getPureIP:r,isDomain:i,ArrayBufferToStr:a,ArrayBufferTo10Str:n,setStringToData:s,setNumberToData:o}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,r){return{playState_ready:"playState_ready",playState_playing:"playState_playing",playState_seeking:"playState_seeking",playState_waiting:"playState_waiting",playState_pause:"playState_pause",playState_progress:"playState_progress",playState_endFragment:"playState_endFragment",playState_startFragment:"playState_startFragment",playState_stop:"playState_stop",playState_done:"playState_done",playState_error:"playState_error",playState_loadState:"playState_loadState",decoderState_error:"decoderState_error",dataState_error_parseHead:"dataState_error_parseHead",dataState_error_parseData:"dataState_error_parseData",LoaderState_ready:"LoaderState_ready",LoaderState_progress:"LoaderState_progress",LoaderState_done:"LoaderState_done",LoaderState_error:"LoaderState_error",LoaderState_error_dispatch:"LoaderState_error_dispatch",LoaderState_error_load:"LoaderState_error_load",LoaderState_error_parseKf:"LoaderState_error_parseKf"}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(){g.init(),I=!0,n(),u=setTimeout(a,1e4)}function n(){P++,(P>=10||v-D+(y-T)+(S-_)>12582912)&&(s(),P=0)}function s(){var e={};e.t="h5timing",e.lp2p=y-T,e.up2p=S-_,e.lcdn=v-D,e.dcdn=0,e.used=b-k,g.tail(e),e.acid=0,e.tcid=0,e.ccid=0,e.dats=l.videoDataSize,e.peern=0,e.srcn=p.size,e.plydu=l.playDuration-w,e.lmax=l.downMax,c(e),g.reset(),D=v,T=y,_=S,k=b,w=l.playDuration}function o(e,t){t?e.add(t):e.add(1)}function h(e){e.t="h5check",c(e)}function c(e){e.uid=l.uuid,e.uif=l.userInfo,e.tvid=l.tvId,e.defi="",e.dlod=l.mobile?"1":"0",e.darea=l.mobile?"1":"0",e.ppapi="false",e.lodt=l.loadType,e.ver=d.version,f.fireUrl(e,m)}var u,l=r(6),d=r(8),f=r(3),p=r(9),g=(r(4),r(12)),m="vodpb.gif"/*tpa=http://msg.video.qiyi.com/vodpb.gif*/,v=0,y=0,S=0,b=0,D=0,T=0,_=0,k=0,w=0,I=!1,P=0;return{start:function(){I||a()},stop:function(){I=!1,clearTimeout(u)},check:h,addPBItem:o,get cdnSize(){return v},get p2pSize(){return y},get upSize(){return S},get usedSize(){return b},set cdnSize(e){v=e},set p2pSize(e){y=e},set upSize(e){S=e},set usedSize(e){b=e}}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e,t,r,i){(e>=32&&d<e||0==e&&""==t&&""==r)&&(d=parseInt(e),c=t,u=r,l=i,clearTimeout(f),f=0,f=setTimeout(function(){localStorage.setItem("idcspeed",d.toString()),localStorage.setItem("preidc",c),localStorage.setItem("preip",u),localStorage.setItem("prews",l?"1":"0"),localStorage.setItem("idctime",Date.now().toString())},1e3))}function n(e){p=e,p+g>m&&(m=p+g,localStorage.setItem("downMax",m.toString()),localStorage.setItem("downTime",Date.now().toString()))}function s(e){g=e,p+g>m&&(m=p+g,localStorage.setItem("downMax",m.toString()),localStorage.setItem("downTime",Date.now().toString()))}function o(e){v=e,v>y&&(y=v,localStorage.setItem("upMax",y.toString()),localStorage.setItem("upTime",Date.now().toString()))}var h=r(7),c="",u="",l=!1,d=0,f=0,p=0,g=0,m=32,v=0,y=32;return function(){var e=parseInt(localStorage.getItem("idctime"));e&&Date.now()-e<864e5&&(c=localStorage.getItem("preidc"),u=localStorage.getItem("preip"),l="1"==localStorage.getItem("prews"),d=parseInt(localStorage.getItem("idcspeed")));var t=parseInt(localStorage.getItem("downTime"));t&&Date.now()-t<864e5&&(m=parseInt(localStorage.getItem("downMax")));var r=parseInt(localStorage.getItem("upTime"));r&&Date.now()-r<864e5&&(y=parseInt(localStorage.getItem("upMax")))}(),{loading:!0,upLoad:!0,onLog:!0,loadType:h.type,get downMax(){return m},get cdnSpeed(){return p},set cdnSpeed(e){n(e)},get downSpeed(){return g},set downSpeed(e){s(e)},get upMax(){return y},get upSpeed(){return v},set upSpeed(e){o(e)},p2pLog:"",tvId:"",userInfo:"none",userIP:"none",userArea:"none",userNetType:"none",uuid:"none",mobile:!1,videoDataSize:0,playDuration:0,lagTime:-1,get preidc(){return""!=u?{idc:c,speed:d,ip:u,ws:l}:null},updatePreIDC:a}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e){this.stateFun=e,this.type=a.type}function n(e){return!(e.byteLength<9)&&(70==e[0]&&(76==e[1]&&(86==e[2]&&1==e[3])))}r(2),r(3),r(1);return a.type="fetch",a.prototype.load=function(e){if(this.AllTask=e,this.cache=new Uint8Array(1048576),this.running=!0,this.reader=null,this.readPos=0,this.dataPos=0,this.base=0,!this.AllTask||!this.AllTask.url)return this.close(),void this.stateFun.call(null,"error","taskError");var t=this.AllTask.url;t.indexOf("?")==-1?this.AllTask.end!=-1&&(t+="?range="+this.AllTask.begin+"-"+(this.AllTask.end-1)):this.AllTask.end!=-1&&(t+="&range="+this.AllTask.begin+"-"+(this.AllTask.end-1));var r=this;fetch(t).then(function(e){if(e.status>=400||e.status<200){if(!r.running)return;r.onError(e.status)}else{if(r.reader=e.body.getReader(),!r.running){if(r.reader)try{r.reader.cancel(),r.reader=null}catch(e){}return}r.pump()}}).catch(function(e){if(r.running)"Failed to fetch"==e.message?r.onError("accessErr"):r.onError(e);else if(r.reader)try{r.reader.cancel(),r.reader=null}catch(e){}})},a.prototype.pump=function(){var e=this;return e.reader.read().then(function(t){if(e.running){var r=t.value;if(r)try{if(e.dataPos+r.byteLength>e.cache.byteLength){var i=new Uint8Array(e.dataPos+r.byteLength),a=e.cache.subarray(e.readPos);i.set(a,0),e.dataPos=e.dataPos-e.readPos,e.base+=e.readPos,e.readPos=0,e.cache=i}if(e.cache.set(r,e.dataPos),e.base+e.dataPos==0&&r.byteLength>=10&&0!=e.AllTask.begin&&n(r.subarray(0,9)))return void e.onError("fromStart");e.dataPos+=r.byteLength}catch(t){return void e.onError(t)}if(e.dataPos-e.readPos>=8192){var s=8192*Math.floor((e.dataPos-e.readPos)/8192);e.AllTask.data=e.cache.subarray(e.readPos,e.readPos+s),e.AllTask.range={begin:e.AllTask.begin+e.base+e.readPos,end:e.AllTask.begin+e.base+e.readPos+s},e.stateFun.call(null,"progress"),e.readPos+=s}if(e.running)return e.AllTask.end==-1&&e.AllTask.segment.size!=-1&&(e.AllTask.end=e.AllTask.segment.size),t.done||e.AllTask.end!=-1&&e.AllTask.begin+e.base+e.dataPos>=e.AllTask.end?(e.readPos<e.dataPos&&(e.AllTask.data=e.cache.subarray(e.readPos,e.dataPos),e.AllTask.range={begin:e.AllTask.begin+e.base+e.readPos,end:e.AllTask.begin+e.base+e.dataPos},e.stateFun.call(null,"progress"),e.readPos=e.dataPos),e.close(),e.stateFun.call(null,"done"),null):e.pump()}else if(e.reader)try{e.reader.cancel(),e.reader=null}catch(e){}})},a.prototype.onError=function(e){if(this.running){if(this.running=!1,this.AllTask=null,this.reader)try{this.reader.cancel(),this.reader=null}catch(e){}"accessErr"==e?this.stateFun.call(null,"error","accessErr"):"fromStart"==e?this.stateFun.call(null,"error","fromStart"):this.stateFun.call(null,"error","netError")}},a.prototype.close=function(){if(this.running&&(this.running=!1,this.AllTask=null,this.reader))try{this.reader.cancel(),this.reader=null}catch(e){}},a}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,r){return{version:"http://static.iqiyi.com/js/player_v1/res/20170713/1.0.20",trackerVersion:2,subPieceSize:1024,videoMaxSize:402653184,checkerInterval:50}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e){return v.has(e)}function n(e){return v.get(e)}function s(e,t){t&&(v.set(e,t),D||(D=!0,d()))}function o(e){var t=v.remove(e);t&&(y==t&&(y=null),S==t&&(S=null),t.destroy())}function h(e){if(e){var t=v.get(e);t?(y&&y.clearTask(),y&&y.alias==t.alias||(S&&S.alias==t.alias&&(S=null),y=t)):y=null}else y=null}function c(e){if(e){var t=v.get(e);S=t&&y&&y.alias!=t.alias?t:null}else S=null}function u(){return S&&y.alias!=S.alias}function l(e){m.resetData();var t=v.values,r=0;m.set16(e.length),m.setCharStr(e);for(var i=0;i<t.length;i++)t[i].vid==e&&r++;m.set16(r);for(var a=0;a<t.length;a++)if(t[a].vid==e){var n=t[a].bitmap;m.set16(n.data.byteLength+8),m.set32(n.alias),m.set32(n.size),m.setBytes(n.data,0,n.data.byteLength)}return m.getData()}function d(){b=0;for(var e=v.values.slice(),t=!1,r=!1,i=0;i<e.length;i++)e[i]&&(b=e[i].memory+b),e[i].peerCnt!=-1&&e[i].peerCnt>1e3&&(t=!0),e[i].peerCnt!=-1&&e[i].peerCnt<=1e3&&(r=!0);if(t&&r){e.sort(function(e,t){return t.peerCnt-e.peerCnt});for(var a=0;a<e.length;a++)if(b>g.videoMaxSize&&e[a]&&3==e[a].state&&e[a].peerCnt>1e3){b-=e[a].memory,o(e[a].alias);break}}e=v.values.slice(),e.sort(function(e,t){return e.shareDataNum-t.shareDataNum});for(var n=0;n<e.length;n++)e[n].shareDataNum=0,b>g.videoMaxSize&&e[n]&&3==e[n].state&&(b-=e[n].memory,o(e[n].alias));if(b>g.videoMaxSize){e=v.values.slice(),e.sort(function(e,t){return e.shareDataNum-t.shareDataNum});for(var s=0;s<e.length;s++)b>g.videoMaxSize&&e[s]&&2==e[s].state&&(b-=e[s].memory,o(e[s].alias))}setTimeout(d,6e4)}function f(){for(var e=0;e<v.keys.length;e++)o(v.keys[e])}var p=r(10),g=r(8),m=r(11),v=new p,y=null,S=null,b=0,D=!1;return{getSegment:n,hasSegment:a,setSegment:s,removeSegment:o,setLoadSegment:h,setPreLoadSegment:c,hasPreLoadSegment:u,get segmentList(){return v.values},get loadSegment(){return y},get preLoadSegment(){return S},get memorySize(){return b},get size(){return v.size},getSourceDescribe:l,destroy:f}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,r){function i(){this.size=0,this.keys=[],this.values=[]}var a;return i.prototype.has=function(e){return this.keys&&this.keys.length>0&&this.keys.indexOf(e)!=-1},i.prototype.get=function(e){return a=this.keys.indexOf(e),a!=-1?this.values[a]:null},i.prototype.set=function(e,t){a=this.keys.indexOf(e),a==-1?(this.size++,this.keys.push(e),this.values.push(t)):this.values[a]=t},i.prototype.remove=function(e){var t;if(e)t=e;else{if(0==this.keys.length)return null;t=this.keys[Math.floor(Math.random()*this.keys.length)]}var r=null,i=this.keys.indexOf(t);return i!=-1&&(this.size--,delete this.keys[i],this.keys.splice(i,1),r=this.values[i],delete this.values[i],this.values.splice(i,1)),r},i.prototype.clear=function(){if(this.size=0,this.keys){for(var e=0;e<this.keys.length;e++)delete this.keys[e];this.keys.length=0}if(this.values){for(var t=0;t<this.values.length;t++)delete this.values[t];this.values.length=0}},i}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,r){function i(){k=0,_=0,I=!1}function a(e){var t=Math.ceil(e.length/2);if(w||l(_+t),null!=S.exec(e))throw"EncodeBuffer setStr string need baseEnCode!";var r=e.length%2;_+t>k&&(l(_+t),k=_+t);for(var i=0;i<e.length;i+=2){var a,n;1==r&&i==e.length-1?(a=parseInt("0x"+e[i]),n=0):(a=parseInt("0x"+e[i]),n=parseInt("0x"+e[i+1])),w[_+Math.ceil(i/2)]=n+15*a}_+=t}function n(e){var t=Math.ceil(e.length);w||l(_+t),_+t>k&&(l(_+t),k=_+t);for(var r=0;r<e.length;r++)w[_+r]=parseInt("0x"+e[r]);_+=t}function s(e){var t=Math.ceil(e.length);w||l(_+t),_+t>k&&(l(_+t),k=_+t);for(var r=0;r<e.length;r++)w[_+r]=e[r].charCodeAt();_+=t}function o(e){w||l(_+1),_+1>k&&(l(_+1),k=_+1),w[_]=e,_+=1}function h(e){w||l(_+2),_+2>k&&(l(_+2),k=_+2);var t=e;t>=T?(w[_]=Math.floor(t/T),t%=T):w[_]=0,w[_+1]=t,_+=2}function c(e){w||l(_+4),_+4>k&&(l(_+4),k=_+4);var t=e;t>=b?(w[_]=Math.floor(t/b),t%=b):w[_]=0,t>=D?(w[_+1]=Math.floor(t/D),t%=D):w[_+1]=0,t>=T?(w[_+2]=Math.floor(t/T),t%=T):w[_+2]=0,w[_+3]=t,_+=4}function u(e,t,r){w||l(_+r),_+r>k&&(l(_+r),k=_+r),w.set(e.subarray(t,t+r),_),_+=r}function l(e){if(e<=0&&(w=null),w){if(e>w.byteLength){var t=new Uint8Array(e);t.set(w,0),w=t}}else w=new Uint8Array(e)}function d(){w=null}function f(){for(_=k,I?_-=4:(w||l(_+4),_+4>k&&(l(_+4),k=_+4)),v=Math.floor(k/4),y=0;y<4;)w[_+y]=w[y*v],y++;_+=4,I=!0}function p(){return new Uint8Array(w.buffer.slice(0,k))}function g(){return new Uint8Array(w.buffer.slice(0,k))}function m(){for(var e="",t=k<=64?k:64,r=0;r<t;r++){var i=w[r];e+=i<16?"0"+i.toString(16):i.toString(16),r<t-1&&(e+="-")}return e}var v,y,S=/[^0-9a-eA-E]+/g,b=16777216,D=65536,T=256,_=0,k=0,w=null,I=!1;return{set position(e){_=e},get position(){return _},get length(){return k},resetData:i,setStr:a,setCharStr:n,setUTF8Str:s,set8:o,set16:h,set32:c,setBytes:u,clear:d,toString:m,crc:f,getData:p,getReferData:g}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){var a,n=r(13);return{stratus_connectCnt:new n("scnt"),stratus_connectSuccess:new n("sscu"),stratus_duration:new n("sdur"),stratus_break:new n("sbrk"),cdn_taskCnt:new n("ctct"),cdn_progressCnt:new n("cpct"),cdn_progressTime:new n("cptm"),cdn_loadTime:new n("cltm"),dispatchKey_Cnt:new n("dkcnt"),dispatchKey_Done:new n("dkdon"),dispatch_Cnt:new n("dict"),dispatch_doneCount:new n("ddct"),dispatch_duration:new n("ddur"),dispatch_reDispatch:new n("dred"),change_definition:new n("cdef"),init:function(){a||(a=[this.stratus_connectCnt,this.stratus_connectSuccess,this.stratus_duration,this.stratus_break,this.cdn_taskCnt,this.cdn_progressCnt,this.cdn_progressTime,this.cdn_loadTime,this.dispatchKey_Cnt,this.dispatchKey_Done,this.dispatch_Cnt,this.dispatch_doneCount,this.dispatch_duration,this.dispatch_reDispatch,this.change_definition])},reset:function(){for(var e=0;e<a.length;e++)a[e].reset()},tail:function(e){for(var t=0;t<a.length;t++)e[a[t].name]=a[t].toString()}}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,r){function i(e){this.name=e,this._count=0}return i.prototype.toString=function(){return this._count.toString()},i.prototype.add=function(e){this._count+=e},i.prototype.reset=function(){this._count=0},i}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e,t){I=[],O=t,y.init(e,d),b.reset(-1,-1,!1),T.cdnErrFun=u}function n(e){for(T.clear(!1);0<I.length;)I[0].state=3,I[0].backUpShowStartTime!=-1&&(I[0].reset(I[0].backUpShowStartTime,I[0].showEndTime,!1),I[0].backUpShowStartTime=-1),delete I[0],I.shift();for(var t=0;t<e.length;t++)e[t].ad?I[t]=new m(e[t],l):I[t]=new g(e[t],l),I[t].order=t}function s(e,t,r){if(0==I.length)throw"fragmentList is empty";if(b.readOrder==-1)throw"need seek first";if(t==-1&&r==Number.MAX_VALUE)throw"param error";if(t!=-1&&r!=Number.MAX_VALUE)throw"param error";T.running&&(t==-1||t>=b.readOrder&&t<P.order)&&T.clear(!1);var i=r,a=t==-1?b.readOrder:t;a<=b.readOrder&&(a=b.readOrder),a==b.readOrder&&b.fragmentEOF&&(i=Number.MAX_VALUE),a>I.length-1&&(a=I.length-1,i=Number.MAX_VALUE);var n=I[a];i==Number.MAX_VALUE||(n.isAD?i=Number.MAX_VALUE:null==n.flvInfo?(b.reset(a,e[0].showStartTime,!0),i=0):b.readOrder==n.order?b.readEndTime!=-1?i<=n.realStartTime+5e3?(b.reset(a,e[0].showStartTime,!0),i=0):i>=n.realEndTime-5e3?i=Number.MAX_VALUE:i<=b.readEndTime&&(i=b.readEndTime):(b.reset(a,e[0].showStartTime,!0),i=0):i<=n.realStartTime+5e3&&(i=0));var s;if(i==Number.MAX_VALUE||0==i){var o=0==i?a:a+1;s=I.slice(0,o);for(var h=0;h<e.length;h++)e[h].ad?s.push(new m(e[h],l)):s.push(new g(e[h],l));I=s.concat(I.slice(o));for(var c=0;c<I.length;c++)I[c].order=c,b.readOrder==c?I[c].state=1:b.readOrder<c?I[c].state=0:I[c].state=2;C&&(C.p2pStopPreLoad(),C=null),P=I[b.readOrder]}else{y.beEnd();var u=n.realEndTime;n.reset(n.realStartTime,i,!1),n.showEndTime=n.realEndTime,s=I.slice(0,a+1);for(var d=0;d<e.length;d++)e[d].ad?s.push(new m(e[d],l)):s.push(new g(e[d],l));var f=new g(n.videoInfo,l);f.showStartTime=n.realEndTime,f.showEndTime=u,s.push(f),I=s.concat(I.slice(a+1));for(var p=0;p<I.length;p++)I[p].order=p,b.readOrder==p?I[p].state=1:b.readOrder<p?I[p].state=0:I[p].state=2;C&&(C.p2pStopPreLoad(),C=null),P=I[b.readOrder]}y.eof=!1,L=!1,E=0,B=0}function o(e,t){if(!(I.length<=0)){var r=-1,i=-1,a=e+t;b.readOrder!=-1&&(b.readOrder>=e&&b.readOrder<a?(r=e,i=I[a].showStartTime):b.readOrder>=a&&(y.videoPointer.order>=e&&y.videoPointer.order<a?(r=e,i=I[a].showStartTime):(D.warn("RemoveFragment {-----}RV Repair readOrder [ "+b.readOrder+" -> "+e+" ]"),b.readOrder-=t)));for(var n;e<a;)a--,n=I.splice(a,1)[0],n&&(n.isAD?n.destroy():n.state=3);for(var s=null,o=0;o<I.length;o++)null!=s&&(s.isAD||I[o].isAD||s.showEndTime!=I[o].showStartTime||s.vid!=I[o].vid||s.index!=I[o].index||(n=I.splice(o,1)[0],r!=-1?o==r?(o--,r=s.order,s.showEndTime=n.showEndTime,s.checkCreateSegment(!1)):r==s.order?(o--,r=s.order,s.showEndTime=n.showEndTime,s.checkCreateSegment(!1)):r>o&&(o--,r--,s.showEndTime=n.showEndTime,s.checkCreateSegment(!1)):b.readOrder!=-1&&(b.readOrder==s.order?(o--,s.showEndTime=n.showEndTime,s.checkCreateSegment(!1)):b.readOrder==o?(o--,b.readOrder--,n.order=s.order,n.showStartTime=s.showStartTime,n.checkCreateSegment(!1),I.splice(o,1),I.splice(o,0,n)):b.readOrder>o&&(o--,b.readOrder--,s.showEndTime=n.showEndTime,s.checkCreateSegment(!1))))),I[o].order=o,s=I[o];if(b.readOrder!=-1){for(var c=0;c<I.length;c++)b.readOrder==c?I[c].state=1:b.readOrder<c?I[c].state=0:I[c].state=2;r!=-1&&i!=-1?h(r,i,!0,!1):(T.clear(!1),C&&(C.p2pStopPreLoad(),C=null),P=I[b.readOrder])}}}function h(e,t,r,i,a){var n=e,s=t;if(!(n<0||n>=I.length)){D.info("[#### "+_.playState_seeking+" [ "+e+" - "+t+" ] ####]"),T.clear(!1),null!=M&&(M=null),i||(x=0),y.eof=!1,L=!1,E=0,B=0,C&&(C.p2pStopPreLoad(),C=null);for(var o=0;o<I.length;o++)I[o].backUpShowStartTime!=-1&&(I[o].reset(I[o].backUpShowStartTime,I[o].showEndTime,!1),I[o].backUpShowStartTime=-1);for(var h=0;h<I.length;h++)n==I[h].order?a&&n<I.length-1&&I[n].showEndTime-s<=4e3?(n+=1,s=I[n].showStartTime,I[h].state=2):(s<I[n].showStartTime&&(s=I[n].showStartTime),s>I[n].showEndTime&&(s=I[n].showEndTime),r?y.clear(!0,n,s):y.beEnd(),b.reset(n,s,!r),P=I[n],P.state=1,P.checkCreateSegment(!0),P.backUpShowStartTime=P.showStartTime,P.reset(s,P.showEndTime,!0),P.p2pLoad(),!P.isAD&&P.checkP2PHealth()>=4&&P.setOnP2P(15e3)):n<I[h].order?I[h].state=0:I[h].state=2;w.start()}}function c(){if(k.loading&&null==M){for(;!L&&P;){if(!P.done){!v.preLoadSegment&&P.approachEnd&&v.memorySize<S.videoMaxSize&&P.order<I.length-1&&P.alias!=I[P.order+1].alias&&(C=I[P.order+1],C.checkCreateSegment(!1),C.p2pPreLoad());break}if(P.order<I.length-1)if(I[P.order+1].done)P=I[P.order+1];else{if(!(v.memorySize<S.videoMaxSize||P.order<=b.readOrder))break;P=I[P.order+1],C&&P.alias==C.alias?(P.p2pLoad(),C=null):(P.checkCreateSegment(!0),P.p2pLoad())}else L||(L=!0,O.call(this,_.playState_done,"",""),D.info("[#### "+_.playState_done+" ####]"))}if(!L&&P){for(var e=b.readOrder;e<=P.order;)e==b.readOrder?E=b.readEndTime==-1?I[e].ceTime-(I[e].realStartTime!=-1?I[e].realStartTime:I[e].showStartTime):I[e].ceTime-b.readEndTime:E+=e==P.order?I[e].realStartTime!=-1?I[e].ceTime-I[e].realStartTime:0:I[e].realEndTime-I[e].realStartTime,e++;E>B&&O.call(this,_.playState_progress),B=E,E+=y.encodeBuffer,T.running||(P.isAD?P.done||P.loadData():E<3e4&&!P.onP2P&&(P.done||P.loadData(12e4-E)))}}if((!y.waiting||E>=y.bufferTime||I[b.readOrder].isAD)&&(y.waiting||y.encodeBuffer<=5e3)&&y.canAppend&&I[b.readOrder].read(b)&&(b.mp4Data.audio.has||b.mp4Data.video.has)&&y.appendBuffer(b.mp4Data),I[b.readOrder].isAD||(k.tvId=I[b.readOrder].tvId),b.fragmentEOF)if(b.readOrder<I.length-1){var t=I[b.readOrder+1];if(null!=t.flvInfo&&t.realStartPos!=-1){b.reset(t.order,t.showStartTime,!0);for(var r=0;r<I.length;r++)b.readOrder<I[r].order?I[r].state=0:b.readOrder==I[r].order?I[r].state=1:I[r].state=2}}else y.eof=!0,y.waiting&&y.state!=_.playState_stop&&(y.state=_.playState_stop,O.call(this,_.playState_stop),D.info("[#### "+_.playState_stop+" ####] , EOFFile , Waiting"))}function u(e,t,r){A="load"http://static.iqiyi.com/js/player_v1/res/20170713/,this.isAD?(w.check({rec:"fail",info:A+"-"+T.loadInfo}),D.error("PlayBackList [CDNError] : "+e+" , "+t+" , "+r),O.call(this,_.playState_error,this.order),D.error("[####"+_.playState_error+"####] , "+e+" , "+t+" , "+r)):(M=this,D.error("PlayBackList [CDNError] : "+e+" , "+t+" , "+r),y.waiting&&(w.check({rec:"fail",info:A+"-"+T.loadInfo}),O.call(this,_.playState_error,M.order),D.error("[####"+_.playState_error+"####] , "+e+" , "+t+" , "+r)))}function l(e,t){switch(e){case _.playState_loadState:O.call(this,_.playState_loadState,this.order,t);break;case _.dataState_error_parseHead:case _.dataState_error_parseData:if(null==M)if(this.parseErrCnt>=3)A="data",M=this,D.error("PlayBackList [VideoDataError] : "+e+" , "+t),y.waiting&&(w.check({rec:"fail",info:"data-"+T.loadInfo}),O.call(this,_.playState_error,M.order),D.error("[####"+_.playState_error+"####] , "+e+" , "+t));else{var r=this.showStartTime;this.showStartTime=-1,this.reset(r,this.showEndTime,!1),h(b.readOrder,Math.max(0,b.readTime-y.encodeBuffer),!0,!0),D.warn("[#### parse data error retry seek  ####] , "+e+" , "+t)}}}function d(e,t,r){switch(e){case _.playState_endFragment:O.call(this,_.playState_endFragment,t,r),y.needClear&&!b.fragmentEOF&&b.readOrder<I.length&&h(b.readOrder,0,!0,!0);break;case _.playState_startFragment:O.call(this,_.playState_startFragment,t,r);break;case _.playState_playing:O.call(this,_.playState_playing),D.info("[#### "+_.playState_playing+" ####] , "+t+" , "+r);break;case _.playState_ready:O.call(this,_.playState_ready),D.info("[#### "+_.playState_ready+" ####] , "+t+" , "+r);break;case _.playState_pause:D.info("[#### "+_.playState_pause+" ####]"),O.call(this,_.playState_pause);break;case _.playState_waiting:null!=M?(w.check({rec:"fail",info:A+"-"+T.loadInfo}),y.state=_.playState_error,O.call(this,_.playState_error,M.order),D.info("[#### "+_.playState_error+" ####] , "+t+" , "+r)):y.eof?(y.state=_.playState_stop,O.call(this,_.playState_stop),D.info("[#### "+_.playState_stop+" ####] , "+t+" , "+r)):!y.needClear&&E<2e3&&(w.check({rec:"lag",info:T.loadInfo,buf:E}),O.call(this,_.playState_waiting),D.info("[#### "+_.playState_waiting+" ####] , "+t+" , "+r));break;case _.playState_stop:O.call(this,_.playState_stop),D.info("[#### "+_.playState_stop+" ####] , "+t+" , "+r);break;case _.decoderState_error:x++,w.check({rec:"decErr",etyp:t+"-"+r}),x>=8?(w.check({rec:"fail",info:"decoder-"+t+"-"+r}),M=I[b.readOrder],O.call(this,_.playState_error,M.order),D.error("[#### "+_.playState_error+" ####] , "+t+" , "+r)):(h(b.readOrder,Math.max(0,b.readTime-y.encodeBuffer),!0,!0),D.warn("[#### retry decoder ####] , "+t+" , "+r))}}function f(){if(b.readOrder==-1||I.length<=0)return"";var e="┏┯┯┯┯┯┯┯┯┯┯┯┯┯┯┯┯┯┯┯┯P2PLog -- "+S.version+"┯┯┯┯┯┯┯┯┯┯┯┯┯┯┯┯┯┓\r\n";e+="decd : ["+Math.ceil(y.currentTime)+"-"+Math.ceil(y.bufferStart)+"-"+Math.ceil(y.bufferEnd)+"-"+Math.ceil(y.encodeBuffer)+"] , vdeo : ["+y.videoPointer.order+" - "+y.videoPointer.time+"] , buff : ["+(L?"DONE":Math.ceil(E))+"-"+P.order+"-"+Math.ceil(P.ceTime)+"]\r\n",e+="[ "+y.state+" ] useSize : "+Math.ceil(w.usedSize/1024)+"K , vdeoSize : "+Math.ceil(k.videoDataSize/1024)+"K , dataSize : "+Math.ceil(v.memorySize/1024)+"K , duration : "+k.playDuration+"Sec \r\n",e+="[ loading : "+T.running+" , cdnSpeed : "+T.speed+"K , cdnSize : "+Math.ceil(w.cdnSize/1024)+"K ] , [ p2pSpeed : "+k.downSpeed+"K , p2pSize : "+Math.ceil(w.p2pSize/1024)+"K ] , < downMax : "+k.downMax+"K > , [ upSpeed : "+k.upSpeed+"K , upSize : "+Math.ceil(w.upSize/1024)+"K ] , < upMax : "+k.upMax+"K >\r\n",I[b.readOrder]&&I[b.readOrder].created&&(e+="RD | "+I[b.readOrder].toDataString(b.readPosition)+"\r\n"),P&&(e+="LD | "+P.vidsDesc+"\r\n",e+="LD | "+P.toDataString(-1)+"\r\n"),C&&(e+="PL | "+C.toDataString(-1)+"\r\n"),e+=k.p2pLog,e+="┗┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┷┛\r\n";for(var t=0;t<I.length;)e+=I[t].describe,b.readOrder==I[t].order&&(e+="R"),e+="-",t++;return e}function p(e){e||T.clear(!1),b.reset(-1,-1,!1),y.reset(e)}var g=r(15),m=r(51),v=(r(3),r(9)),y=r(40),S=r(8),b=r(39),D=r(2),T=r(43),_=r(4),k=r(6),w=r(5),I=(r(41),null),P=null,C=null,L=!1,E=0,B=0,O=null,M=null,x=0,A="";return{init:a,seek:h,run:c,freshFragments:n,addFragment:s,removeFragment:o,resume:function(){y.resume()},pause:function(){y.pause()},reset:p,get readPointer(){return b},get fragments(){return I},get playInfo(){return y.videoPointer},get encodeBuffer(){return y.encodeBuffer},get bufferInfo(){return P?{order:P.order,time:P.ceTime}:null},get eof(){return y.eof},get done(){return L},get log(){return f()},get version(){return S.version}}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e,t){this.order=-1,this.stateChangeFun=t,this.videoInfo=e,this.isAD=e.ad,this.vid=e.vid,this.vids=e.vidl,this.tvId=e.tvId.toString(),this.albumID=e.albumID.toString(),this.channelID=e.channelID.toString(),this.originID=e.originID.toString(),this.vip=e.vip,this.index=e.index,this.size=e.size,this.startTime=e.startTime,this.endTime=e.endTime,this.showStartTime=e.showStartTime,this.backUpShowStartTime=-1,this.showEndTime=e.showEndTime,this.alignTime=!1,this.rate=Math.ceil(this.size/(this.endTime-this.startTime)),this.realStartTime=-1,this.realStartPos=-1,this.realEndTime=-1,this.realEndPos=-1,this.lastCEPos=-1,this.parseTime=-1,this.parsePos=-1,this.p2pID="",
""!=this.originID&&"0"!=this.originID&&void 0!=this.originID&&0!=this.originID?this.p2pID=parseInt("0x"+f.calculate(this.originID).substr(0,10)).toString():""!=this.albumID&&"0"!=this.albumID&&void 0!=this.albumID&&0!=this.albumID?this.p2pID=parseInt("0x"+f.calculate(this.albumID).substr(0,10)).toString():""!=this.tvId&&"0"http://static.iqiyi.com/js/player_v1/res/20170713/!=this.tvId&&void 0!=this.tvId&&0!=this.tvId?this.p2pID=parseInt("0x"+f.calculate(this.tvId).substr(0,10)).toString():this.p2pID=this.vid,this.vip&&this.videoInfo.boss&&(this._keyTime=this.videoInfo.boss.bossKeyTime,this._key=this.videoInfo.boss.data.t);var r=this.dispatchUrl,i=r.indexOf(".f4v"),a=r.lastIndexOf("/",i);this.sourceID=r.slice(a+1,i),this.index>=16?this.alias=parseInt("0x"+p.sliceStr(this.sourceID+this.vid,6)+this.index.toString(16)):this.alias=parseInt("0x"+p.sliceStr(this.sourceID+this.vid,6)+"0"+this.index.toString(16)),this.fragmentName=this.alias+"_"+this.index+"|"+this.showStartTime+"-"+this.showEndTime,this.endOnP2PTime=-1,this.idc="",this.ip="",this.ws=!1,this.errIDCList=[],this.segment&&this.segment.size!=this.size&&o.removeSegment(this.alias),this.parseErrCnt=0}var n=r(16),s=r(4),o=r(9),h=r(24),c=(r(39),r(43)),u=r(38),l=r(31),d=r(5),f=r(50),p=r(3),g=null;return a.prototype.checkCreateSegment=function(e){if(this.segment){if(this.segment.size!=this.size){console.log("checkCreateSegment [segment size check] : "+this.fragmentName),o.removeSegment(this.alias);var t=new h(this.size,this.sourceID,this.index,this.alias,this.vid,this.p2pID,this.vip);t.rate=this.rate,t.vids=this.vids,t.proxyList.push(this),o.setSegment(this.alias,t)}}else{console.log("checkCreateSegment [segment is null] : "+this.fragmentName);var r=new h(this.size,this.sourceID,this.index,this.alias,this.vid,this.p2pID,this.vip);r.rate=this.rate,r.vids=this.vids,r.proxyList.push(this),o.setSegment(this.alias,r)}this.segment.fragmentName=this.fragmentName;var i=this;if(this.segment.refreshFun=function(){i&&i.refreshBuffer.call(i)},this.flvInfo){console.log("checkCreateSegment [flvInfo OK] : "+this.fragmentName);var a=this.getIDRByTime(this.showStartTime);this.parseTime=this.realStartTime=a.time,this.lastCEPos=this.parsePos=this.realStartPos=a.position,a=this.getNextIDRByTime(this.showEndTime),this.realEndTime=a.time,this.realEndPos=a.position,this.segment.setRange(this.realStartPos,this.realEndPos)}else this.refreshBuffer(),this.parseData(e)},a.prototype.dataReset=function(){this.parseTime=this.realStartTime=-1,this.lastCEPos=this.parsePos=this.realStartPos=-1,this.realEndTime=-1,this.realEndPos=-1,console.log("fragment be reset : "+this.fragmentName)},a.prototype.reset=function(e,t,r){if(this.endOnP2PTime=-1,(e!=this.showStartTime||t!=this.showEndTime)&&(this.alignTime=1==r,this.showStartTime=e,this.showEndTime=t,this.fragmentName=this.alias+"_"+this.index+"|"+this.showStartTime+"-"+this.showEndTime,this.segment&&(this.segment.fragmentName=this.fragmentName),this.flvInfo)){var i;i=this.getIDRByTime(this.showStartTime),this.parseTime=this.realStartTime=i.time,this.lastCEPos=this.parsePos=this.realStartPos=i.position,i=this.getNextIDRByTime(this.showEndTime),this.realEndTime=i.time,this.realEndPos=i.position,this.segment.setRange(this.realStartPos,this.realEndPos),this.refreshBuffer(),this.parseData(!1)}},a.prototype.setTrackerIP=function(e){l&&!l.hasProxyByIP(e)&&(u.stunIP="stun:"+e+":3478",l.startProxy(this.p2pID,e))},a.prototype.pushData=function(e,t,r){return!this.segment||!(this.flvInfo&&!this.parseKF(e,t,r))&&(this.segment.addData(t,e,r),d.cdnSize=r+d.cdnSize,this.segment.peerMgr&&(this.segment.peerMgr.serverProxy.cdnSize=r+this.segment.peerMgr.serverProxy.cdnSize),!0)},a.prototype.parseKF=function(e,t,r){for(var i=this.flvInfo.info.keyframes.filepositions,a=0;a<i.length;a++)if(i[a]+11<t+r&&i[a]>=t&&e[i[a]-t]!=n.TAG_TYPE_VIDEO&&1!=(e[i[a]-t+11]>>4&15)&&a!=i.length-1)return!1;return!0},a.prototype.loadData=function(e){if(this.segment)if(this.flvInfo){var t,r,i=this.ceTime+e;this.realEndTime-i<=15e3?r=this.realEndPos:(t=this.getNextIDRByTime(i),r=t?t.position:this.realEndPos),this.realEndPos-r<524288&&(r=this.realEndPos);var a=this.checkTask(this.lastCEPos,r);c.load(this,a)}else if(this.startTime==this.showStartTime){var n=this.checkTask(0,Math.min(e*this.rate,this.size));c.load(this,n)}else this.parseData(!0)},a.prototype.read=function(e){if(this.segment&&!e.fragmentEOF)if(this.flvInfo){var t;if(e.readPosition==-1){if(e.readTime==-1)return!1;t=this.getIDRByTime(e.readTime),e.readPosition=t.position,e.readTime=t.time}if(e.readPosition>=this.realEndPos)return e.fragmentEOF=!0,e.resetData(),!0;if(t=this.getNextIDRByPos(e.readPosition),!(this.parsePos>=e.readPosition))return e.keyFrame=!1,!1;if(this.parsePos<t.position){if(e.keyFrame=!1,!(t.position-this.parsePos>=131072))return!1;t.position=this.parsePos}else e.keyFrame=!0;if(t.position>e.readPosition)return g=this.segment.getData(e.readPosition,t.position-e.readPosition),e.fragmentEOF=t.position>=this.realEndPos,d.usedSize=t.position-e.readPosition+d.usedSize,this.segment.peerMgr&&(this.segment.peerMgr.serverProxy.usedSize=t.position-e.readPosition+this.segment.peerMgr.serverProxy.usedSize),e.packetFMP4(this,g,this.realStartPos==e.readPosition)}else this.parseData(!0);return!1},a.prototype.refreshBuffer=function(){this.segment&&this.segment.cePos>this.lastCEPos&&(this.realEndPos!=-1?this.lastCEPos=Math.min(this.segment.cePos,this.realEndPos):this.lastCEPos=this.segment.cePos,this.parseData(!0))},a.prototype.parseData=function(e){function t(e){g=o.segment.getData(o.parsePos,e);var t=n.check(g);t.correct?(t.position>0&&(o.parsePos+=t.position),t.endTime>0&&(o.parseTime=t.endTime)):(h=!1,o.parseErrCnt++,o.segment.deleteRange(0,o.size),o.stateChangeFun.call(o,s.dataState_error_parseHead,""))}if(!this.flvInfo)if(this.segment.hasData(0,8192)){g=this.segment.getData(0,8192);try{this.segment.flvInfo=n.pickUpHead(g)}catch(e){this.segment.flvInfo=null}if(!this.flvInfo)return this.segment.flvInfo=null,this.parseErrCnt++,this.segment.deleteRange(0,this.size),void this.stateChangeFun.call(this,s.dataState_error_parseHead,"");for(var r=this.flvInfo.info.keyframes.times,i=0;i<r.length;i++)r[i]=1e3*r[i];var a;a=this.getIDRByTime(this.showStartTime),this.parseTime=this.realStartTime=a.time,this.lastCEPos=this.parsePos=this.realStartPos=a.position,a=this.getNextIDRByTime(this.showEndTime),this.realEndTime=a.time,this.realEndPos=a.position,this.segment.setRange(this.realStartPos,this.realEndPos)}else c.running||(e?c.load(this,[{begin:0,end:8192}]):c.load(this,[]));if(this.flvInfo){if(this.lastCEPos-this.parsePos<8192&&this.lastCEPos<this.realEndPos)return;for(var o=this,h=!0;h;){var u=this.lastCEPos-this.parsePos;if(5242880<u?u=5242880:h=!1,0==u)return;t(u)}g=null}},a.prototype.__defineGetter__("vidsDesc",function(){return this.segment?this.segment.vidsDesc:""}),a.prototype.__defineGetter__("onP2P",function(){return Date.now()<this.endOnP2PTime}),a.prototype.setOnP2P=function(e){this.endOnP2PTime=e+Date.now(),c.loadStage="urgencyP2P"},a.prototype.__defineGetter__("onTracker",function(){return l.hasProxyByID(this.p2pID)}),a.prototype.__defineGetter__("created",function(){return o.hasSegment(this.alias)}),a.prototype.__defineGetter__("segment",function(){return o.getSegment(this.alias)}),a.prototype.__defineGetter__("flvInfo",function(){return this.segment?this.segment.flvInfo:null}),a.prototype.__defineGetter__("approachEnd",function(){return!!this.segment&&this.segment.approachEnd}),a.prototype.__defineGetter__("dataUrl",function(){return this.segment?this.segment.dataUrl:""}),a.prototype.__defineSetter__("dataUrl",function(e){this.segment&&(this.segment.dataUrl=e)}),a.prototype.__defineSetter__("state",function(e){this.segment&&(this.segment.state=e)}),a.prototype.__defineGetter__("ceTime",function(){return this.parseTime!=-1?this.parseTime:this.showStartTime}),a.prototype.__defineGetter__("done",function(){return!(!this.segment||!this.segment.flvInfo||this.realEndPos==-1)&&this.parsePos>=this.realEndPos}),a.prototype.checkTask=function(e,t){return this.segment?this.segment.checkTask(e,t):{begin:e,end:t}},a.prototype.recycleCDNTask=function(e){this.segment&&this.segment.recycleCDNTask(e)},a.prototype.p2pPreLoad=function(){o.setPreLoadSegment(this.alias)},a.prototype.checkP2PHealth=function(){return this.segment?this.segment.checkP2PHealth():0},a.prototype.p2pStopPreLoad=function(){o.setPreLoadSegment()},a.prototype.p2pLoad=function(){o.setLoadSegment(this.alias)},a.prototype.toDataString=function(e){return this.fragmentName+"_order_"+this.order+"\r\n"+this.segment.toDataString(e,this.realStartPos,this.realEndPos)},a.prototype.__defineGetter__("key",function(){return!this._keyTime||Date.now()-this._keyTime>108e5?"":this._key}),a.prototype.__defineSetter__("key",function(e){this._keyTime=Date.now(),this._key=e}),a.prototype.__defineGetter__("dispatchUrl",function(){return this.videoInfo?this.vip?!this._keyTime||Date.now()-this._keyTime>108e5?"":this.videoInfo.getUrl(this._key):this.videoInfo.getUrl():""}),a.prototype.__defineGetter__("bossUrl"http://static.iqiyi.com/js/player_v1/res/20170713/,function(){return this.videoInfo&&this.vip?this.videoInfo.getBossUrl():""}),a.prototype.__defineGetter__("describe",function(){for(var e=this.videoInfo.startTime,t="[ "+this.index+" ";e<this.videoInfo.endTime;)t+=e>=this.showStartTime&&e<=this.showEndTime?"_":"x",e+=6e4;return t+"]"}),a.prototype.getIDRByTime=function(e){var t=this.flvInfo.info.keyframes.filepositions,r=this.flvInfo.info.keyframes.times;if(this.alignTime){for(var i=-1,a=0;a<t.length;a++)if(e<=r[a]){a>0&&Math.abs(r[a]-e)>Math.abs(e-r[a-1])&&a--,i=a;break}return i==-1&&(i=r.length-1),0==i&&r.length>1&&(i=1),{position:t[i],time:r[i]}}for(var n=0;n<t.length;n++)if(e<=r[n])return n>0&&e<r[n]&&n--,0==n&&r.length>0&&(n=1),{position:t[n],time:r[n]};return{position:t[t.length-1],time:r[t.length-1]}},a.prototype.getNextIDRByTime=function(e){for(var t=this.flvInfo.info.keyframes.filepositions,r=this.flvInfo.info.keyframes.times,i=0;i<t.length;i++)if(e<=r[i]){if(0==i&&r.length>0&&(i=1),i==r.length-1)break;return{position:t[i],time:r[i]}}return{position:this.size,time:this.endTime}},a.prototype.getNextIDRByPos=function(e){for(var t=this.flvInfo.info.keyframes.filepositions,r=this.flvInfo.info.keyframes.times,i=0;i<t.length;i++)if(e<t[i]){if(0==i&&r.length>0&&(i=1),i==r.length-1)break;return{position:t[i],time:r[i]}}return{position:this.size,time:this.endTime}},a}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e){var t={};t.info=null,o(e);var r=0,i=0;m&&i++,v&&i++,t.hasVideo=m,t.hasAudio=v;for(var a=0,n=0,s=13,c=e.byteLength;s+15<=c&&(e[s]==p||e[s]==f||e[s]==g)&&0==e[s+8]&&0==e[s+9]&&(a=(e[s+1]<<16)+(e[s+2]<<8)+e[s+3],s+a+15<=c&&a>=0)&&(n=(e[s+1+11+a]<<16)+(e[s+2+11+a]<<8)+e[s+3+11+a]-11,a==n);){if(e[s]==g){var u=h.AMFdeSerialize(e.subarray(s,s+n+11));t.info=u.onMetaData,t.info.length=u.length,i++}else e[s]==p?t.videoConfigTag=new l(t.info,e.subarray(s,s+n+11)):t.audioConfigTag=new d(t.info,e.subarray(s,s+n+11));if(r++,r>=i)return t;s+=n+4+11}return null}function n(e){for(var t={dataLen:0,video:{list:[],dataLen:0,time:-1,endTime:-1},audio:{list:[],dataLen:0,time:-1,endTime:-1}},r=0,i=0,a=null,n=null,s=0;s+15<=e.byteLength;){if(i=-1,e[s]!=p&&e[s]!=f&&e[s]!=g)throw"tagTypeError:"+e[s].toString();if(i=(e[s+1]<<16)+(e[s+2]<<8)+e[s+3],!(i>=0))throw"tagSizeError:"+i;if(!(s+i+15<=e.byteLength))break;if(r=(e[s+1+11+i]<<16)+(e[s+2+11+i]<<8)+e[s+3+11+i]-11,i!=r)throw"tagEndSizeError:"+r;if(e[s]==p){var o=new c(e.subarray(s,s+r+11));t.video.dataLen+=o.NALUData.byteLength,t.video.list.push(o),t.video.endTime=o.time,t.video.time==-1&&(t.video.time=o.time),a&&a.duration==-1&&(a.duration=o.time-a.time),a=o}else if(e[s]==f){var h=new u(e.subarray(s,s+r+11));t.audio.dataLen+=h.NALUData.byteLength,t.audio.list.push(h),t.audio.endTime=h.time,t.audio.time==-1&&(t.audio.time=h.time),n&&n.duration==-1&&(n.duration=h.time-n.time),n=h}s+=r+4+11,t.dataLen=s}return t}function s(e){for(var t={position:0,endTime:0,correct:!0,message:""},r=-1,i=40,a=0,n=0,s=0;s+15<=e.byteLength;){if(n=-1,e[s]!=p&&e[s]!=f&&e[s]!=g){t.correct=!1,t.message="tagTypeError:"+e[s].toString();break}if(n=(e[s+1]<<16)+(e[s+2]<<8)+e[s+3],!(s+n+15<=e.byteLength))break;if(a=(e[s+1+11+n]<<16)+(e[s+2+11+n]<<8)+e[s+3+11+n]-11,n!=a){t.correct=!1,t.message="tagEndSizeError:"+a;break}if(e[s]==p){var o=e[s+7]<<24|e[s+4]<<16|e[s+5]<<8|e[s+6];r==-1?r=o:(i=o-r,r=o),t.endTime=r+i}s+=a+4+11,t.dataLen=s}return t.position=s,t}function o(e){if(e.byteLength<9)throw"FLVHeader() input too short";if(70!=e[0])throw"FLVHeader readHeader() Signature[0] not 'F'";if(76!=e[1])throw"FLVHeader readHeader() Signature[1] not 'L'";if(86!=e[2])throw"FLVHeader readHeader() Signature[2] not 'V'";if(1!=e[3])throw"FLVHeader readHeader() Version not 0x01";var t=e[4];v=!!(4&t),m=!!(1&t)}var h=r(17),c=r(18),u=r(19),l=r(20),d=r(23),f=8,p=9,g=18,m=!1,v=!1;return{pickUpHead:a,parseData:n,check:s,TAG_TYPE_AUDIO:8,TAG_TYPE_VIDEO:9,TAG_TYPE_SCRIPTDATAOBJECT:18}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,r){function i(e){var t={},r=(e[1]<<16)+(e[2]<<8)+e[3],i=e.subarray(11,11+r),n=a(i,!1);return t.length=n.valueLength+15,t[n.key]=n.value,t}function a(e,t){var r,i,a;t?(a=new Uint8Array(1+e.byteLength),a[0]=2,a.set(e,1),r=n(a),i=n(a.subarray(r.valueLength)),r.valueLength-=1):(a=e,r=n(a),i=n(a.subarray(r.valueLength)));var s={};return s.key=r.value,s.value=i.value,s.valueLength=r.valueLength+i.valueLength,s}function n(e){var t,r={};switch(e[0]){case 0:t=8,r.value=new DataView(e.buffer).getFloat64(1+e.byteOffset),r.valueLength=1+t;break;case 1:t=1,r.value=0!=new DataView(e.buffer).getInt8(1+e.byteOffset),r.valueLength=1+t;break;case 2:t=e[1]<<8|e[2],r.value=s(e.subarray(3,3+t)),r.valueLength=3+t;break;case 3:for(t=1,r.value={};0!=e[t]||0!=e[t+1]||9!=e[t+2];){var i=a(e.subarray(t),!0);r.value[i.key]=i.value,t+=i.valueLength}t+=3,r.valueLength=t;break;case 4:t=e[1]<<8|e[2],r.value=s(e.subarray(3,3+t)),r.valueLength=3+t;break;case 5:r.value=null,t=1,r.valueLength=t;break;case 6:r.value=void 0,t=1,r.valueLength=t;break;case 7:r.value=e[1]<<8|e[2],t=3,r.valueLength=t;break;case 8:var o=e[1]<<24|e[2]<<16|e[3]<<8|e[4];t=5,r.value={};for(var h=0;h<o;h++){var c=a(e.subarray(t),!0);r.value[c.key]=c.value,t+=c.valueLength}t+=3,r.valueLength=t;break;case 9:throw new Error("no catch stop label");case 10:for(var u=[],l=e[1]<<24|e[2]<<16|e[3]<<8|e[4],d=0;d<l;d++)u.push(n(e.subarray(9*d+4+1)).value);r.value=u,t=9*u.length+4+1,r.valueLength=t;break;case 11:r.value=new DataView(e).getFloat64(1),t=11,r.valueLength=t;break;case 12:t=e[1]<<24|e[2]<<16|e[3]<<8|e[4],r.value=s(e.subarray(5,5+t)),r.valueLength=5+t;break;default:return null}return r}function s(e){for(var t="",r=0;r<e.byteLength;r++)t+=String.fromCharCode(e[r]);return t}return{AMFdeSerialize:i}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,r){function i(e){this.time=(e[7]<<24)+(e[4]<<16)+(e[5]<<8)+e[6],this.CompositionTime=(e[13]<<16)+(e[14]<<8)+e[15],this.NALUData=e.slice(16),this.isKeyframe=e[11]>>4==1,this.duration=-1,this.flags={isLeading:0,dependsOn:this.isKeyframe?2:1,isDependedOn:this.isKeyframe?1:0,hasRedundancy:0,isNonSync:this.isKeyframe?0:1}}return i}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,r){function i(e){this.time=(e[7]<<24)+(e[4]<<16)+(e[5]<<8)+e[6],this.CompositionTime=0,this.NALUData=e.slice(13),this.duration=-1,this.flags={isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}return i}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e,t){this.meta=e,this.timescale=1e3,this.id=1,this.type="video",this.duration=0;var r=t;if(r[11]>>4!=1)throw"FLVConfigTagVideo is not Key Frame tag!";if(7!=(15&r[11]))throw"FLV File must be AVC CodecID!";if(0!=r[12])throw"AVC must be AVCDecoderConfigurationRecord";if(this.AVCPacketData=r.slice(16),1!==r[16]||0===r[17])throw"Invalid AVCDecoderConfigurationRecord";var i=(3&r[20])+1;if(3!==i&&4!==i)throw"Flv: Strange NaluLengthSizeMinusOne: "+i;var a=31&r[21];if(1!=a)throw"AVC sequence header has more than 1 sps!";var s=(r[22]<<8)+r[23],o=r.slice(24,24+s);this.sps=n.parse(o),this.sampleDuration=Math.floor(this.timescale*(this.sps.frame_rate.fps_den/this.sps.frame_rate.fps_num));var h=o.subarray(1,4);this.codec="avc1.";for(var c=0;c<3;c++){var u=h[c].toString(16);u.length<2&&(u="0"+u),this.codec+=u}}var n=(r(3),r(21));return a}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e){u.reset(n(e)),u.readByte();var t=u.readByte();u.readByte();var r=u.readByte();u.readUEG();var i=o(t),a=h(r),l=1,d=420,f=[0,420,422,444],p=8;if((100===t||110===t||122===t||244===t||44===t||83===t||86===t||118===t||128===t||138===t||144===t)&&(l=u.readUEG(),3===l&&u.readBits(1),l<=3&&(d=f[l]),p=u.readUEG()+8,u.readUEG(),u.readBits(1),u.readBool()))for(var g=3!==l?8:12,m=0;m<g;m++)u.readBool()&&(m<6?s(u,16):s(u,64));u.readUEG();var v=u.readUEG();if(0===v)u.readUEG();else if(1===v){u.readBits(1),u.readSEG(),u.readSEG();for(var y=u.readUEG(),S=0;S<y;S++)u.readSEG()}u.readUEG(),u.readBits(1);var b=u.readUEG(),D=u.readUEG(),T=u.readBits(1);0===T&&u.readBits(1),u.readBits(1);var _=0,k=0,w=0,I=0,P=u.readBool();P&&(_=u.readUEG(),k=u.readUEG(),w=u.readUEG(),I=u.readUEG());var C=1,L=1,E=0,B=!0,O=0,M=0,x=u.readBool();if(x){if(u.readBool()){var A=u.readByte(),j=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],z=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];A>0&&A<16?(C=j[A-1],L=z[A-1]):255===A&&(C=u.readByte()<<8|u.readByte(),L=u.readByte()<<8|u.readByte())}if(u.readBool()&&u.readBool(),u.readBool()&&(u.readBits(4),u.readBool()&&u.readBits(24)),u.readBool()&&(u.readUEG(),u.readUEG()),u.readBool()){var R=u.readBits(32),U=u.readBits(32);B=u.readBool(),O=U,M=2*R,E=O/M}}var F=1;1===C&&1===L||(F=C/L);var N=0,G=0;if(0===l)N=1,G=2-T;else{var H=3===l?1:2,V=1===l?2:1;N=H,G=V*(2-T)}var q=16*(b+1),K=(2-T)*(16*(D+1));q-=(_+k)*N,K-=(w+I)*G;var W=Math.ceil(q*F);return u.destroy(),{profile_string:i,level_string:a,bit_depth:p,chroma_format:d,chroma_format_string:c(d),frame_rate:{fixed:B,fps:E,fps_den:M,fps_num:O},sar_ratio:{width:C,height:L},codec_size:{width:q,height:K},present_size:{width:W,height:K}}}function n(e){for(var t=e,r=t.byteLength,i=new Uint8Array(r),a=0,n=0;n<r;n++)n>=2&&3===t[n]&&0===t[n-1]&&0===t[n-2]||(i[a]=t[n],a++);return new Uint8Array(i.buffer,0,a)}function s(e,t){for(var r=8,i=8,a=0,n=0;n<t;n++)0!==i&&(a=e.readSEG(),i=(r+a+256)%256),r=0===i?r:i}function o(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}function h(e){return(e/10).toFixed(1)}function c(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}var u=r(22);return{parse:a}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,r){function i(e){d=e,f=0,p=e.byteLength,g=8*e.byteLength,m=0,v=0}function a(){var e=p-f;if(e<=0)throw"_fillCurrentWord() but no bytes available";var t=Math.min(4,e),r=new Uint8Array(4);r.set(d.subarray(f,f+t)),m=new DataView(r.buffer).getUint32(0,!1),f+=t,v=8*t}function n(){var e=void 0;for(e=0;e<v;e++)if(0!==(m&2147483648>>>e))return m<<=e,v-=e,e;return a(),e+n()}function s(e){if(e>32)throw"readBits() bits exceeded max 32bits!";if(e<=v){var t=m>>>32-e;return m<<=e,v-=e,t}var r=v?m:0;r>>>=32-v;var i=e-v;a();var n=Math.min(i,v),s=m>>>32-n;return m<<=n,v-=n,r=r<<n|s}function o(){var e=n();return s(e+1)-1}function h(){var e=o();return 1&e?e+1>>>1:-1*(e>>>1)}function c(){return s(8)}function u(){return 1===s(1)}function l(){d=null}var d=null,f=0,p=0,g=0,m=0,v=0;return{reset:i,readBits:s,readUEG:o,readByte:c,readSEG:h,readBool:u,destroy:l}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e,t){if(this.meta=e,this.timescale=1e3,this.id=2,this.type="audio",this.duration=0,this.config=null,this.SoundFormat=t[11]>>4,10!=this.SoundFormat)throw"FLV File is not ACC codec : "+this.SoundFormat;var r=(15&t[11])>>2;if(r>4)throw"FLV File unknown sampleRate type : "+r;this.sampleRate=[5500,11025,22050,44100,48e3][r],this.sampleDuration=Math.floor(1024/this.sampleRate*this.timescale);var i=(2&t[11])>>1;if(this.sampleSize=8*(i+1),this.SoundType=1&t[11],this.channelCount=0===this.SoundType?1:2,this.AACPacketType=t[12],0!=this.AACPacketType)throw"AACPacketType is not AAC sequence header";if(this.audioObjectType=(248&t[13])>>3,2!=this.audioObjectType&&5!=this.audioObjectType&&29!=this.audioObjectType)throw"audioObjectType type : "+this.audioObjectType+" is not support!";var a=(7&t[13])<<1|t[14]>>7;if(this.sampleRate=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][a],this.sampleDuration=Math.floor(1024/this.sampleRate*this.timescale),this.channelConfiguration=t[14]>>3&15,this.channelConfiguration<0||this.channelConfiguration>=8)throw"Flv: AAC invalid channel configuration";var n=window.navigator.userAgent.toLowerCase();n.indexOf("firefox")!==-1?a>=6?(this.audioObjectType=5,this.config=new Array(4),this.extensionSamplingIndex=a-3):(this.audioObjectType=2,this.config=new Array(2),this.extensionSamplingIndex=a):n.indexOf("android")!==-1?(this.audioObjectType=2,this.config=new Array(2),this.extensionSamplingIndex=a):(this.audioObjectType=5,this.config=new Array(4),this.extensionSamplingIndex=a,a>=6?this.extensionSamplingIndex=a-3:1===this.channelConfiguration&&(this.audioObjectType=2,this.config=new Array(2),this.extensionSamplingIndex=a)),this.codec="mp4a.40."+this.audioObjectType,this.config[0]=this.audioObjectType<<3,this.config[0]|=(15&a)>>>1,this.config[1]=(15&a)<<7,this.config[1]|=(15&this.channelConfiguration)<<3,5===this.audioObjectType&&(this.config[1]|=(15&this.extensionSamplingIndex)>>>1,this.config[2]=(1&this.extensionSamplingIndex)<<7,this.config[2]|=8,this.config[3]=0)}r(3);return a}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e,t,r,i,a,n,h){this.proxyList=[],this.vid=a,this.sourceID=t,this.p2pID=n,this.alias=i,this.peerCnt=-1,this.flvInfo=null,this.vids=null,this.size=e,this.index=r,this.vip=h,this.refreshFun=null,this.shareDataNum=0,this.state=0,this.ceSID=0,this.gpSID=0,this.pieceNum=Math.ceil(this.size/f),this.subPcNum=Math.ceil(this.size/p),this.bitmap=new o(this.pieceNum,this.alias),this.subBitmap=new o(this.subPcNum,this.alias),this.runSubBitmap=new o(this.subPcNum,this.alias),this.bsID=0,this.esID=this.subPcNum,this.fragmentName="",this.rate=-1,this._checkDataStep=0,this._p2pCheckDataStep=0,this._TMPKeyList=[],this._TMPDataList=[],this._TMPRcvCnt=0,s.create(this.alias,this.size)}var n=5242880,s=r(25),o=r(28),h=r(8),c=r(30),u=r(31),l=r(5),d=256,f=262144,p=h.subPieceSize;a.prototype.setRange=function(e,t){var r=Math.floor(this.bsID/d);this.bitmap.getBit(r)&&!this.subBitmap.checkRange(r*d,(r+1)*d)&&this.bitmap.setBit(r,!1);var i=Math.ceil(this.esID/d);this.bitmap.getBit(i)&&!this.subBitmap.checkRange(i*d,(i+1)*d)&&this.bitmap.setBit(i,!1),this.bsID=Math.floor(e/p),this.esID=Math.ceil(t/p),this.checkGpSID(this.bsID),this.checkCEPos(this.bsID),this.refreshFun&&this.refreshFun.call(null)},a.prototype.addData=function(e,t,r){s.get(this.alias).writeBytes(t,e,r);for(var i=Math.ceil(e/p),a=e+r>=this.size?this.subPcNum:Math.floor((e+r)/p);i<a;)this.subBitmap.setBit(i,!0),this.runSubBitmap.setBit(i,!0),i++;var n=this;0==e&&8192==r?this.checkData():0==this._checkDataStep&&(this._checkDataStep=setTimeout(function(){n&&n.checkData.call(n)},500))},a.prototype.checkData=function(){clearTimeout(this._checkDataStep),this._checkDataStep=0,this.checkGpSID(this.gpSID);for(var e=Math.floor(this.bsID/d),t=Math.ceil(this.size/f);e<t;){var r=e*d,i=(e+1)*d;this.bsID>=r&&this.bsID<=i&&(r=this.bsID),this.esID>=r&&this.esID<=i&&(i=this.esID),this.subBitmap.checkRange(r,i)&&this.bitmap.setBit(e,!0),e++}this.checkCEPos(this.ceSID),this.refreshFun&&this.refreshFun.call(null)},a.prototype.getData=function(e,t){return s.get(this.alias).readBytes(e,t)},a.prototype.hasData=function(e,t){for(var r=Math.floor(e/p),i=Math.ceil(Math.min(e+t,this.size)/p);r<i;){if(!this.subBitmap.getBit(r))return!1;r++}return!0},a.prototype.checkCEPos=function(e){for(var t=void 0!=e?e:this.ceSID;t<this.subPcNum&&this.subBitmap.getBit(t);)t++;this.ceSID=Math.min(t,this.subPcNum)},a.prototype.deleteRange=function(e,t){for(var r=Math.min(e+t,this.size),i=Math.floor(e/p),a=Math.ceil(r/p);i<a;)this.subBitmap.setBit(i,!1),this.runSubBitmap.setBit(i,!1),i++;for(var n=Math.floor(e/f),s=Math.ceil(r/f);n<s;)this.bitmap.setBit(n,!1),n++;this.checkGpSID(this.bsID),this.checkCEPos(this.bsID)},a.prototype.checkTask=function(e,t){for(var r=Math.floor(e/p),i=Math.min(this.subPcNum,Math.ceil(t/p)),a=[],n=0,s=-1,o=-1;r<i;)this.subBitmap.getBit(r)?(s!=-1&&n++,n>=32&&(a.push({begin:s*p,end:Math.min((o+1)*p,this.size)}),s=-1,o=-1,n=0)):(n=0,s==-1&&(s=r),o=r,this.runSubBitmap.setBit(r,!0)),r++;return s!=-1&&a.push({begin:s*p,end:Math.min((o+1)*p,this.size)}),this.checkGpSID(this.gpSID),a},a.prototype.recycleCDNTask=function(e){for(var t,r,i,a=0;a<e.length;a++)for(t=e[a],r=Math.floor(t.begin/p),i=Math.min(this.subPcNum,Math.ceil(t.end/p));r<i;)this.subBitmap.getBit(r)||this.runSubBitmap.setBit(r,!1),r++;this.checkGpSID(this.bsID),this.checkCEPos(this.bsID)},a.prototype.recycleP2PTask=function(e){!this.subBitmap.getBit(e.subPieceID)&&this.runSubBitmap.getBit(e.subPieceID)&&(this.runSubBitmap.setBit(e.subPieceID,!1),e.subPieceID<this.gpSID&&this.checkGpSID(e.subPieceID))},a.prototype.checkGpSID=function(e){for(this.gpSID=e;this.gpSID<this.subPcNum&&!(!this.runSubBitmap.getBit(this.gpSID)&&!this.subBitmap.getBit(this.gpSID)&&this.gpSID>=this.bsID&&this.gpSID<=this.esID);)this.gpSID++},a.prototype.addSubPiece=function(e,t){if(this._TMPRcvCnt++,p==t.byteLength&&this._TMPKeyList.indexOf(e)==-1){for(var r=!1,i=0;i<this._TMPKeyList.length;i++)if(this._TMPKeyList[i]*p+this._TMPDataList[i].byteLength==e*p){r=!0;var a=new Uint8Array(this._TMPDataList[i].byteLength+t.byteLength);a.set(this._TMPDataList[i],0),a.set(t,this._TMPDataList[i].byteLength),this._TMPDataList[i]=a;break}if(r||(this._TMPKeyList.push(e),this._TMPDataList.push(t)),this._TMPRcvCnt>=50)this.mergeData();else if(0==this._p2pCheckDataStep){var n=this;this._p2pCheckDataStep=setTimeout(function(){n&&n.mergeData.call(n)},100)}l.p2pSize=p+l.p2pSize,this.peerMgr&&(this.peerMgr.serverProxy.p2pSize=p+this.peerMgr.serverProxy.p2pSize)}},a.prototype.mergeData=function(){for(clearTimeout(this._p2pCheckDataStep),this._p2pCheckDataStep=0;this._TMPKeyList.length>0;){var e=this._TMPDataList.shift();this.addData(this._TMPKeyList.shift()*p,e,e.byteLength)}this._TMPRcvCnt=0},a.prototype.pieceNeed=function(e){return e>=this.bID&&e<=this.eID&&!this.bitmap.getBit(e)},a.prototype.subPieceNeed=function(e){return e>=this.bsID&&e<=this.esID&&!this.subBitmap.getBit(e)};var g,m,v,y,S;return a.prototype.getTasks=function(e,t,r,i){if(e&&e.alias==this.alias&&!(this.gpSID>=this.esID)){for(g=e,m=Math.max(this.gpID,g.gpID),v=Math.min(Math.ceil(this.esID/d),m+16),y=this.gpSID;m<v&&t.length<r;){if(g.getBit(m)&&this.pieceNeed(m))for(y=m*d,S=Math.min((m+1)*d,this.subPcNum),this.gpSID>y&&this.gpSID<S&&(y=this.gpSID);y<S&&t.length<r;){if(this.subPieceNeed(y)){var a=new c(this.alias,y);a.rto=i,t.push(a),this.runSubBitmap.setBit(y,!0)}y++}m++}t.length>0&&this.checkGpSID(this.gpSID)}},a.prototype.clearTask=function(){this.peerMgr&&this.peerMgr.clearTask()},a.prototype.checkP2PHealth=function(){return this.peerMgr?this.peerMgr.checkP2PHealth(this.alias):0},a.prototype.requestTask=function(e){return this.subBitmap.getBit(e)?(this.shareDataNum++,l.upSize=l.upSize+p,this.peerMgr&&(this.peerMgr.serverProxy.upSize=p+this.peerMgr.serverProxy.upSize),this.getData(e*p,p)):null},a.prototype.checkDefinition=function(e){if(this.vidsDesc="[ ",this.vids&&this.vids.length>1&&e.length>1)for(var t=0;t<this.vids.length;t++){for(var r=0;r<e.length;r++)if(this.vids[t].vid==e[r].vid){this.vids[t].count=e[r].count;break}this.vidsDesc+=this.vids[t].rate+":"+this.vids[t].count+" , "}this.vidsDesc+=" ]"},a.prototype.__defineGetter__("peerMgr",function(){return u.getProxyByID(this.p2pID)}),a.prototype.__defineGetter__("cePos",function(){return Math.min(this.ceSID*p,this.size)}),a.prototype.__defineGetter__("done",function(){return this.gpSID>=0&&this.gpSID>=this.esID}),a.prototype.__defineGetter__("gpID",function(){return Math.floor(this.gpSID/d)}),a.prototype.__defineGetter__("eID",function(){return Math.ceil(this.esID/d)}),a.prototype.__defineGetter__("bID",function(){return Math.floor(this.bsID/d)}),a.prototype.__defineGetter__("approachEnd",function(){return this.cePos>=this.size-n}),a.prototype.__defineGetter__("memory",function(){return s.get(this.alias).memory}),a.prototype.__defineGetter__("dataUrl",function(){return this._dataUrlTime+5e5<Date.now()&&(this._dataUrl=""),this._dataUrl}),a.prototype.__defineSetter__("dataUrl",function(e){this._dataUrl=e,this._dataUrlTime=Date.now()}),a.prototype.toDataString=function(e,t,r){for(var i="|",a=Math.floor((e!=-1?e:t)/f),n=0,s=Math.floor(t/f),o=Math.floor(r/f),h=Math.ceil(this.size/f),c=this.gpID,u=Math.floor(this.ceSID/d),l="";n<h;)this.bitmap.getBit(n)?(l="*",u==n&&c==n?l="(EG)":u==n?l="E":c==n&&(l="G")):(l="_",u==n&&c==n?l="(eg)":u==n?l="e":c==n&&(l="g")),void 0!=a&&a==n&&(l="R"),s==n&&(l="‹"+l),o==n&&(l+="›"),i+=l,n++,n%128==0&&(i+="\r");return i+="|"},a.prototype.destroy=function(){for(console.log("Segment be destroy : "+this.fragmentName),s.remove(this.alias),this.peerMgr&&this.peerMgr.removeSource(this.vid);this.proxyList.length>0;){var e=this.proxyList.shift();try{e&&e.dataReset()}catch(e){}}},a}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e){return c.get(e)}function n(e,t){c.has(e)||c.set(e,new o(t))}function s(e){c.has(e)&&(c.get(e).clear(),c.remove(e))}var o=r(26),h=r(10),c=new h;return{create:n,get:a,remove:s}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e){this.readSize=Math.ceil(e/d.subPieceSize)*d.subPieceSize,this.chunkNum=Math.ceil(this.readSize/f),this.dataArr=[];for(var t=0;t<this.chunkNum;)this.dataArr.push(new l(f,t,t*f)),t++}var n,s,o,h,c,u,l=r(27),d=r(8),f=1048576;return a.prototype.readBytes=function(e,t){if(n=e,s=n+t-1,n>=this.readSize||t<=0||s>=this.readSize)throw"readBytes param Error!";o=Math.floor(n/f),h=Math.floor(s/f);for(var r=0,i=new Uint8Array(t);o<=h;){c=o*f,n>=c&&(c=n),u=o*f+f-1,u>=s&&(u=s);var a=this.dataArr[o].getData(c,u-c+1);i.set(a,r),r+=u-c+1,o++}return i},a.prototype.writeBytes=function(e,t,r){if(n=t,s=n+r-1,n>=this.readSize||r<=0||s>this.readSize||!e)throw"writeBytes param Error!";o=Math.floor(n/f),h=Math.floor(s/f);for(var i=0;o<=h;)c=o*f,n>=c&&(c=n),u=o*f+f-1,u>=s&&(u=s),this.dataArr[o].setData(e.subarray(i,i+(u-c+1)),c),i+=u-c+1,o++},a.prototype.clear=function(){for(var e=0;e<this.chunkNum;)this.dataArr[e]&&this.dataArr[e].clear(),e++;delete this.data,delete this.dataArr},a.prototype.__defineGetter__("memory",function(){if(!this.dataArr)return 0;for(var e=0,t=0;e<this.chunkNum;)this.dataArr[e]&&(t+=this.dataArr[e].memory),e++;return t}),a}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e,t,r){this.index=t,this.base=r,this.size=e,this.u8a=null}var n=r(6);return a.prototype.setData=function(e,t){this.u8a||(n.videoDataSize+=this.size,this.u8a=new Uint8Array(this.size)),this.u8a.set(e,t-this.base)},a.prototype.getData=function(e,t){return this.u8a.subarray(e-this.base,e-this.base+t)},a.prototype.clear=function(){this.u8a&&(n.videoDataSize-=this.size,delete this.u8a)},a.prototype.__defineGetter__("memory",function(){return this.u8a?this.size:0}),a}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e,t){this.alias=t,this.gpID=-1,e&&(this.size=e,this.data=new Uint8Array(Math.ceil(this.size/8)));
}var n=r(11),s=r(29);return a.prototype.getBit=function(e){if(e>=0&&e<this.size){var t=e%8,r=Math.floor(e/8),i=this.data[r],a=1<<t;return 0!=(i&a)}return!1},a.prototype.setBit=function(e,t){if(e>=0&&e<this.size){var r=e%8,i=Math.floor(e/8);1==t?this.data[i]=this.data[i]|1<<r:this.data[i]=this.data[i]&~(1<<r)}},a.prototype.getByte=function(e){return e>=0&&e+8<=this.size&&e%8==0&&255==this.data[Math.floor(e/8)]},a.prototype.setByte=function(e,t){e>=0&&e<this.size&&e%8==0&&(t?this.data[Math.floor(e/8)]=255:this.data[Math.floor(e/8)]=0)},a.prototype.checkRange=function(e,t){for(t>this.size&&(t=this.size);e<t;)if(e%8==0&&e+8<=t){if(255!=this.data[Math.floor(e/8)])return!1;e+=8}else{if(!this.getBit(e))return!1;e++}return!0},a.prototype.toData=function(){return n.resetData(),n.set32(this.alias),n.set32(this.size),n.setBytes(this.data,0,this.data.byteLength),n.getData()},a.prototype.fromData=function(e){s.resetData(e),this.alias=s.get32(),this.size=s.get32(),this.data=s.getBytes(e.byteLength-8)},a.prototype.resetGap=function(e){if((0==e||e)&&e!=-1)for(this.gpID=e;this.gpID<this.size&&!this.getBit(this.gpID);)this.gpID++},a.prototype.toString=function(){for(var e="",t=0,r=this.size,i="";t<r;)i=this.getBit(t)?"*":"_",e+=i,t++,t%128==0&&(e+="\r\n");return e+="|"},a.prototype.reset=function(e){for(var t=0;t<Math.ceil(this.size/8);t++)this.data[t]=e?255:0},a.prototype.clear=function(){delete this.data,this.head&&delete this.head},a}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,r){function i(e){if(e){if(e instanceof ArrayBuffer)b=e.byteLength,D=new Uint8Array(e);else{if(!(e instanceof Uint8Array))return;b=e.byteLength,D=e}S=0}}function a(e){if(!D)return"";var t=Math.ceil(e/2),r=e%2;if(S+t>b&&(t=b-S),t<=0)return"";for(var i="",a=0;a<t;a++){var n,s,o=D[S+a];1==r&&a==t-1?(n=Math.floor(o/15),i+=n.toString(16)):(n=Math.floor(o/15),s=o%15,i+=n.toString(16)+s.toString(16))}return S+=t,i}function n(e){if(!D)return"";var t=Math.ceil(e);if(S+t>b&&(t=b-S),t<=0)return"";for(var r="",i=0;i<t;i++){var a=D[S+i];r+=a.toString(16)}return S+=t,r}function s(e){if(!D)return"";var t=Math.ceil(e);if(S+t>b&&(t=b-S),t<=0)return"";for(var r="",i=0;i<t;i++){var a=D[S+i];r+=String.fromCharCode(a)}return S+=t,r}function o(){if(!D||S+1>b)return 0;var e=D[S];return S+=1,e}function h(){if(!D||S+2>b)return 0;var e=D[S]*y+D[S+1];return S+=2,e}function c(){if(!D||S+4>b)return 0;var e=D[S]*m+D[S+1]*v+D[S+2]*y+D[S+3];return S+=4,e}function u(e){if(!D||S+e>b)return null;var t=D.subarray(S,S+e);return S+=e,t}function l(){for(S=b-4,p=Math.floor(b/4),g=0;g<4;){if(D[S+g]!=D[g*p])return!1;g++}return!0}function d(){D=null}function f(){for(var e="",t=b<=64?b:64,r=0;r<t;r++){var i=D[r];e+=i<16?"0"+i.toString(16):i.toString(16),r<t-1&&(e+="-")}return e}var p,g,m=16777216,v=65536,y=256,S=0,b=0,D=null;return{set position(e){S=e},get position(){return S},get length(){return b},resetData:i,getStr:a,getCharStr:n,getUTF8Str:s,get8:o,get16:h,get32:c,getBytes:u,clear:d,crc:l,toString:f}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,r){function i(e,t){this.rto=3e3,this.alias=e,this.subPieceID=t,this.beginTime=Date.now()}return i.prototype.__defineGetter__("key",function(){return this.alias.toString()+"_"+this.subPieceID.toString()}),i.prototype.__defineGetter__("timeOut",function(){return this.beginTime+this.rto}),i}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(){if(y>=30){y=0;var e=0,t=0;d.p2pLog="",p&&(d.p2pLog+=p.check(d.onLog),e+=p.upSpeed,t+=p.downSpeed),g&&(d.p2pLog+=g.check(d.onLog),e+=g.upSpeed,t+=g.downSpeed),d.downSpeed=t,d.upSpeed=e;var r=Math.min(Math.max(d.upMax,32),768);Math.ceil(Date.now()/1e3%100)<=20?f.sendMax=1.2*r:f.sendMax=.8*r}y%2==0?(f.check(),y++):(y++,p&&p.onTimer(),g&&g.onTimer()),m=setTimeout(a,33)}function n(e){return p&&e==p.id?p:g&&e==g.id?g:null}function s(e){return!(!p||e!=p.id)||g&&e==g.id}function o(e){return p&&e==p.ip?p:g&&e==g.ip?g:null}function h(e){return!(!p||e!=p.ip)||g&&e==g.ip}function c(e,t){v||(a(),v=!0),null==p?p=new l(e,t):null==g?g=new l(e,t):p.upTaskSum>g.upTaskSum?(g.destroy(),g=new l(e,t)):(p.destroy(),p=new l(e,t))}function u(){p&&p.destroy(),g&&g.destroy(),v&&(clearTimeout(m),m=0,v=!1)}var l=r(32),d=r(6),f=(r(33),r(35)),p=null,g=null,m=0,v=!1,y=30;return{startProxy:c,getProxyByID:n,hasProxyByID:s,getProxyByIP:o,hasProxyByIP:h,destroy:u}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e,t){var r=this;this.id=e,this.ip=t,this.serverProxy=new o(this.id,t,function(e,t,i){r.TrackerMessage(e,t,i)}),this.localID="",this.removePeers=new s,this.workPeers=new s,this.trackerPeers=new s,this.upTaskSum=0,this.downTaskSum=0,this.upSpeed=0,this.downSpeed=0}var n,s=r(10),o=r(33),h=r(34),c=r(9),u=r(35),l=r(37),d=0;a.prototype.TrackerMessage=function(e,t,r){switch(e){case o.State_register:this.localID=t;break;case o.State_upDatePeers:this.localID=t,this.updatePeers(r);break;case o.State_candidate:n=this.workPeers.get(t),n&&n.candidate(r);break;case o.State_offer:n=this.workPeers.get(t),n?n.offer(r):this.acceptPeer(t,r);break;case o.State_answer:n=this.workPeers.get(t),n&&n.answer(r);break;case o.State_Error:}},a.prototype.onTimer=function(){for(var e in this.workPeers.values)this.workPeers.values[e].check()};var f="";return a.prototype.check=function(e){this.addPeer(),this.weedOutPeer(),this.connectPeer(),this.upSpeed=0,this.downSpeed=0,f="",e&&(f+="---- tracker ID : "+this.id+" , IP : "+this.serverProxy.ip+" , localD : "+this.localID+"\r\n");for(var t in this.workPeers.values){var r=this.workPeers.values[t];e&&(f+=r.log+"\r\n"),this.upSpeed+=r.upHB,this.downSpeed+=r.rcvHB,this.upTaskSum+=r.upHB,this.downTaskSum+=r.rcvHB,r.reset()}return f},a.prototype.addPeer=function(){(!this.getPeerMark||this.getPeerMark+1e4<Date.now())&&c.loadSegment&&!c.loadSegment.done&&this.trackerPeers.size<8&&c.loadSegment.p2pID==this.id&&(this.getPeerMark=Date.now(),this.serverProxy.getPeer(c.loadSegment))},a.prototype.weedOutPeer=function(){if(!this.weedOutPeerMark||this.weedOutPeerMark+3e4<Date.now()){this.weedOutPeerMark=Date.now();for(var e,t=0,r=0;r<this.workPeers.size;r++){var i=this.workPeers.keys[r],a=this.workPeers.get(i);if(!a.protected){var n=a.rcvCnt-(a.rcvCntLT?a.rcvCntLT:0);a.rcvCntLT=a.rcvCnt;var s=a.upCnt-(a.upCntLT?a.upCntLT:0);a.upCntLT=a.upCnt,(s+n<t||0==t)&&(t=s+n,e=a)}}this.workPeers.size>6&&e&&this.removePeerNode(e,l.poorTunnel)}},a.prototype.connectPeer=function(){for(;this.trackerPeers.size>0&&d<12;){var e=this.trackerPeers.remove();if(e&&!this.checkErrPeerID(e)){var t=new h(this,e,!0);this.workPeers.set(e,t),u.channelDict.has(e)||u.channelDict.set(e,t),d<12&&d++;break}}},a.prototype.acceptPeer=function(e,t){if(d<16&&!this.workPeers.has(e)){var r=new h(this,e,!1,t);this.workPeers.set(e,r),u.channelDict.has(e)||u.channelDict.set(e,r),d<16&&d++}},a.prototype.checkErrPeerID=function(e){if(null==e||""==e||e==this.localID)return!0;if(this.workPeers.get(e))return!0;if(this.trackerPeers.get(e))return!0;var t=this.removePeers.get(e);return null!=t&&Date.now()-t.time<t.duration},a.prototype.updatePeers=function(e){if(e){this.trackerPeers.clear();for(var t=0;t<e.length;t++){var r=e[t];this.workPeers.has(r)||null==r||""==r||r==this.localID||this.trackerPeers.has(r)||this.trackerPeers.set(r,r)}}},a.prototype.clearTask=function(){for(var e=0;e<this.workPeers.size;e++){var t=this.workPeers.get(this.workPeers.keys[e]);t&&t.clearTask()}},a.prototype.checkP2PHealth=function(e){for(var t=0,r=0;r<this.workPeers.size;r++){var i=this.workPeers.values[r];i.checkHealth(e)?t++:this.workPeers.size>6&&this.removePeerNode(i,l.none)}return t},a.prototype.checkClose=function(){for(var e=0;e<c.segmentList.length;e++)if(c.segmentList[e].p2pID==this.id)return!1;return!0},a.prototype.removePeerNode=function(e,t){if(null!=e){u.channelDict.has(e.peerID)&&u.channelDict.remove(e.peerID),this.workPeers.has(e.peerID)&&(this.workPeers.remove(e.peerID),d>0&&d--);var r={};r.time=Date.now(),r.duration=9e4,this.removePeers.set(e.peerID,r),e.peerClose(t)}},a.prototype.offer=function(e,t){this.serverProxy.offer(e,t)},a.prototype.answer=function(e,t){this.serverProxy.answer(e,t)},a.prototype.candidate=function(e,t){this.serverProxy.candidate(e,t)},a.prototype.removeSource=function(e){this.serverProxy.removeSource(e)},a.prototype.destroy=function(){for(var e=0;e<this.workPeers.size;e++){var t=this.workPeers.get(this.workPeers.keys[e]);t&&this.removePeerNode(t,l.none),d>0&&d--}this.removePeers.clear(),this.workPeers.clear(),this.trackerPeers.clear(),this.serverProxy.clear()},a}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e,t,r){this.socket=null,this.trackerStateFun=r,this.uid="",this.startTime=0,this.watcherStep=0,this.socketTimeStep=0,this.retryStep=0,this.reconnectCnt=0,this.id=e,this.ip=t,this.running=!0,this.cdnSize=0,this.p2pSize=0,this.upSize=0,this.usedSize=0,this.last_cdnSize=0,this.last_p2pSize=0,this.last_upSize=0,this.last_usedSize=0,this.last_playDuration=0,this.conect()}var n=45e3,s=1,o=2,h=3,c=4,u=5,l=6,d=7,f=256,p=r(9),g=r(2),m=r(8),v=r(6),y=r(5),S=r(12),b=r(11),D=r(29);a.State_upDatePeers="State_upDatePeers",a.State_register="State_register",a.State_candidate="State_candidate",a.State_offer="State_offer",a.State_answer="State_answer",a.State_Error="State_error",a.prototype.conect=function(){if(clearTimeout(this.retryStep),this.retryStep=0,this.reconnectCnt++,!(this.reconnectCnt>=6)){y.addPBItem(S.stratus_connectCnt);var e=this;this.socket=new WebSocket("ws://"+this.ip+":873/ws",["binary"]),this.socket.binaryType="arraybuffer",this.socket.onopen=function(t){e.onOpen.call(e,t)},this.socket.onmessage=function(t){e.onData.call(e,t)},this.socket.onerror=function(t){e.onError.call(e,t)},this.socket.onclose=function(t){e.onClose.call(e,t)},clearTimeout(this.socketTimeStep),this.socketTimeStep=setTimeout(function(){e.onTimeout.call(e)},5e3),this.startTime=Date.now(),g.info("tracker [START] IP : "+this.ip)}},a.prototype.onOpen=function(e){g.info("tracker [SUCCESS] IP : "+this.ip),y.addPBItem(S.stratus_connectSuccess),y.addPBItem(S.stratus_duration,Date.now()-this.startTime),clearTimeout(this.socketTimeStep),this.register()},a.prototype.onTimeout=function(){this.running&&(g.warn("tracker [ERROR] to : "+this.ip+" , msg : connect timeout"),this.error())},a.prototype.onClose=function(e){this.running&&(y.addPBItem(S.stratus_break),g.warn("tracker [ERROR] to : "+this.ip+" , msg : onClose-"+e.data),this.error())},a.prototype.onError=function(e){this.running&&(g.warn("tracker [ERROR] to : "+this.ip+" , msg : onError-"+e.data),this.error())},a.prototype.error=function(){if(this.running&&this.socket&&this.socket.readyState==WebSocket.CLOSED){this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null;var e=this;e.retryStep=setTimeout(function(){e.conect.call(e)},2e3)}};var T=null,_=0,k=0,w="",I=0,P=0,C="",L=0,E="",B=0,O=0,M="";return a.prototype.onData=function(e){if(D.resetData(e.data),T=D.get16(),this.running&&this.socket)switch(T){case s:I=D.get16(),0==I?(k=D.get16(),w=D.getCharStr(k),this.uid=w,this.trackerStateFun.call(this,a.State_register,this.uid),this.heartBeat()):(g.warn("tracker [ERROR] register error"),this.error());break;case h:if(I=D.get16(),0==I){v=D.get16();for(var t=0;t<v;t++){L=D.get16(),E=D.getCharStr(L),B=D.get16();for(var r=0;r<B;r++){O=D.get16(),M=parseInt(D.getCharStr(O)),_=D.get32();for(var i=0;i<p.segmentList.length;i++)p.segmentList[i].p2pID==this.id&&p.segmentList[i].vid==E&&p.segmentList[i].index==M&&(p.segmentList[i].peerCnt=_)}}}else g.warn("tracker [ERROR] update error");break;case c:if(I=D.get16(),0==I){if(this.trackerStateFun){var n=D.get32();_=D.get16();for(var f=[],m=0;m<_;m++)k=D.get16(),w=D.getCharStr(k),f.push(w);if(this.peerSegment){for(var v=D.get16(),y=[],S=0;S<v;S++)L=D.get16(),E=D.getCharStr(L),n=D.get32(),y.push({vid:E,count:n});this.peerSegment.checkDefinition(y),this.peerSegment=null}this.trackerStateFun.call(this,a.State_upDatePeers,this.uid,f)}}else g.warn("tracker [ERROR] query error");break;case u:k=D.get16(),w=D.getCharStr(k),P=D.get16(),C=D.getUTF8Str(P),C&&w&&this.trackerStateFun&&this.trackerStateFun.call(this,a.State_candidate,w,JSON.parse(C));break;case l:k=D.get16(),w=D.getCharStr(k),P=D.get16(),C=D.getUTF8Str(P),C&&w&&this.trackerStateFun&&this.trackerStateFun.call(this,a.State_offer,w,JSON.parse(C));break;case d:k=D.get16(),w=D.getCharStr(k),P=D.get16(),C=D.getUTF8Str(P),C&&w&&this.trackerStateFun&&this.trackerStateFun.call(this,a.State_answer,w,JSON.parse(C));break;case o:break;default:g.warn("tracker [ERROR] not Support token : "+T)}},a.prototype.register=function(){if(this.running&&this.socket&&this.socket.readyState==WebSocket.OPEN){b.resetData(),b.set16(s),b.set16(m.trackerVersion),b.set16(this.uid.length),b.setCharStr(this.uid);var e=b.getReferData();this.socket.send(e)}else y.addPBItem(S.stratus_break),this.error()},a.prototype.unRegister=function(){},a.prototype.removeSource=function(e){},a.prototype.heartBeat=function(){var e=this;if(clearTimeout(this.watcherStep),this.running&&this.socket&&this.socket.readyState==WebSocket.OPEN){b.resetData(),b.set16(h);for(var t=[],r=0;r<p.segmentList.length;r++)p.segmentList[r].p2pID==this.id&&1==v.upLoad&&(t.push(p.segmentList[r].index>9?p.segmentList[r].index.toString():"0"+p.segmentList[r].index.toString()),t.push(p.segmentList[r].vid));b.set16(t.length/2);for(var i=0;i<t.length;i+=2)b.set16(t[i].length),b.setCharStr(t[i]),b.set16(t[i+1].length),b.setCharStr(t[i+1]);var a=b.getReferData();this.socket.send(a),setTimeout(function(){e.pingBack.call(e)},100)}else y.addPBItem(S.stratus_break),this.error();this.watcherStep=setTimeout(function(){e.heartBeat.call(e)},n)},a.prototype.getPeer=function(e){if(this.peerSegment=e,this.running&&this.socket&&this.socket.readyState==WebSocket.OPEN){var t=e.vid,r=e.vids,i=e.index>9?e.index.toString():"0"+e.index.toString();if(b.resetData(),b.set16(c),b.set16(t.length),b.setCharStr(t),b.set16(i.length),b.setCharStr(i),r&&r.length>0){b.set16(r.length);for(var a=0;a<r.length;a++)b.set16(r[a].vid.length),b.setCharStr(r[a].vid)}else b.set16(1),b.set16(t.length),b.setCharStr(t);var n=b.getReferData();this.socket.send(n)}else y.addPBItem(S.stratus_break),this.error()},a.prototype.candidate=function(e,t){if(this.running&&this.socket&&this.socket.readyState==WebSocket.OPEN){C=JSON.stringify(t),b.resetData(),b.set16(u),b.set16(e.length),b.setCharStr(e),b.set16(C.length),b.setUTF8Str(C);var r=b.getReferData();this.socket.send(r)}else y.addPBItem(S.stratus_break),this.error()},a.prototype.offer=function(e,t){if(this.running&&this.socket&&this.socket.readyState==WebSocket.OPEN){C=JSON.stringify(t),b.resetData(),b.set16(l),b.set16(e.length),b.setCharStr(e),b.set16(C.length),b.setUTF8Str(C);var r=b.getReferData();this.socket.send(r)}else y.addPBItem(S.stratus_break),this.error()},a.prototype.answer=function(e,t){if(this.running&&this.socket&&this.socket.readyState==WebSocket.OPEN){C=JSON.stringify(t),b.resetData(),b.set16(d),b.set16(e.length),b.setCharStr(e),b.set16(C.length),b.setUTF8Str(C);var r=b.getReferData();this.socket.send(r)}else y.addPBItem(S.stratus_break),this.error()},a.prototype.pingBack=function(){if(this.running&&this.socket&&this.socket.readyState==WebSocket.OPEN){b.resetData(),b.set16(f),b.set32(this.cdnSize-this.last_cdnSize),b.set32(this.p2pSize-this.last_p2pSize),b.set32(this.usedSize-this.last_usedSize),b.set32(this.upSize-this.last_upSize),b.set32(v.videoDataSize),b.set32(v.playDuration-this.last_playDuration);var e=b.getReferData();this.socket.send(e),this.last_cdnSize=this.cdnSize,this.last_p2pSize=this.p2pSize,this.last_upSize=this.upSize,this.last_usedSize=this.usedSize,this.last_playDuration=v.playDuration}else y.addPBItem(S.stratus_break),this.error()},a.prototype.clear=function(){this.running=!1,this.socket&&(this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null,this.socket.close(),this.socket=null),clearTimeout(this.socketTimeStep),clearTimeout(this.retryStep),clearTimeout(this.watcherStep)},a}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e,t,r,i){y.call(this,e,t,r,i),this.checked=!1,this.srtt=0,this.sdev=0,this.quota=32,this.mtu=1,this.lostR=0,this.lostHB=0,this.loadHB=0,this.rcvHB=0,this.upHB=0,this.lostCnt=0,this.loadCnt=0,this.rcvCnt=0,this.upCnt=0,this.peerInfo={loadBitmap:null,hasBitmap:!1,sourceID:"",alias:"",vid:"",peerLocalID:"",lostR:0,preInfo:{loadBitmap:null,hasBitmap:!1,sourceID:"",alias:""}},this.taskList=new m,this.srcDscr=new m,this.quit=this.onQuit,this.heartbeat=this.onHeartbeat,this.request=this.onRequest,this.receive=this.onReceive,this.clear=this.onClearTask,this.refuse=this.onRefuseTask,this.describe=this.onDescribe,this.checkRTOLastTime=-1,this.heartbeatLastTime=-1,this.heartbeatCnt=6,this.createdTime=Date.now()}function n(e){for(c.resetData(),c.set8(p.version),c.set8(p.receiveMediaData),c.set32(e.alias),c.set8(e.sIDList.length);e.sIDList.length>0;)c.set32(e.sIDList.shift()),c.setBytes(e.dataList.shift(),0,h.subPieceSize);return c.crc(),c.getReferData()}var s=.125,o=.25,h=r(8),c=r(11),u=r(29),l=r(35),d=r(28),f=r(6),p=r(36),g=r(37),m=r(10),v=r(9),y=r(38),S=Math.floor(4294967295*Math.random()),b=new m;a.prototype=y.prototype,a.prototype.constructor=a,a.prototype.check=function(){this.baseCheck()&&(this.checkHeartbeat()||this.loadTask(),this.checkRTO())};var D={preInfo:{}};a.prototype.checkHeartbeat=function(){if(Date.now()-this.heartbeatLastTime>3e3&&v.loadSegment){if(D.localID=S,D.vid=v.loadSegment.vid,D.alias=v.loadSegment.alias,D.sourceID=v.loadSegment.sourceID,v.preLoadSegment?(D.preInfo.alias=v.preLoadSegment.alias,D.preInfo.sourceID=v.preLoadSegment.sourceID):(D.preInfo.alias="",D.preInfo.sourceID=""),""!=this.peerInfo.alias&&v.hasSegment(this.peerInfo.alias)&&1==f.upLoad){var e=v.getSegment(this.peerInfo.alias);D.bitmap=e.bitmap.toData()}else D.bitmap=null;if(""!=this.peerInfo.preInfo.alias&&v.hasSegment(this.peerInfo.preInfo.alias)&&1==f.upLoad){var t=v.getSegment(this.peerInfo.preInfo.alias);D.preInfo.bitmap=t.bitmap.toData()}else D.preInfo.bitmap=null;return 0==this.loadHB?D.lostR=255:D.lostR=this.lostR,this.fireData(p.heartbeat,D),this.lostHB=0,this.loadHB=0,this.lostR>5?this.lostR-=5:this.lostR=0,this.heartbeatCnt++,this.heartbeatCnt>10&&(this.heartbeatCnt=0,this.fireSourceDescribe()),this.heartbeatLastTime=Date.now(),!0}return!1};var T=[];a.prototype.loadTask=function(){if(l.loadQuota>0&&this.peerInfo.hasBitmap&&f.loading&&v.loadSegment&&this.peerInfo.loadBitmap.alias==v.loadSegment.alias){if(this.quota<this.taskList.size)return;var e=Math.max(this.srtt<200?this.quota/2:this.quota/3,1),t=Math.min(this.quota-this.taskList.size,e);if(T.length=0,v.loadSegment.getTasks(this.peerInfo.loadBitmap,T,t,this.timeout),t-=T.length,T.length>0){this.loadHB=this.loadHB+T.length,this.loadCnt=this.loadCnt+T.length;for(var r=0;r<T.length;r++)this.taskList.set(T[r].key,T[r]);this.fireData(p.requestMediaData,T),l.loadQuota=l.loadQuota-r}if(t>0&&this.peerInfo.preInfo.hasBitmap&&v.preLoadSegment&&this.peerInfo.preInfo.loadBitmap.alias==v.preLoadSegment.alias&&(T.length=0,v.preLoadSegment.getTasks(this.peerInfo.preInfo.loadBitmap,T,t,this.timeout),T.length>0)){this.loadHB=this.loadHB+T.length,this.loadCnt=this.loadCnt+T.length;for(var i=0;i<T.length;i++)this.taskList.set(T[i].key,T[i]);this.fireData(p.requestMediaData,T),l.loadQuota=l.loadQuota-i}}},a.prototype.checkRTO=function(){if(!(Date.now()-this.checkRTOLastTime<=500)){this.checkRTOLastTime=Date.now();for(var e=0,t=0;t<this.taskList.values.length;t++){var r=this.taskList.values[t];if(Date.now()-r.beginTime>r.rto){e++;var i=v.getSegment(r.alias);i&&i.recycleP2PTask(r),this.taskList.remove(r.key),t--}}this.updateQuota(e),this.lostCnt=this.lostCnt+e,this.lostHB=this.lostHB+e,this.lostR=this.lostR+e}},a.prototype.__defineGetter__("timeout",function(){if(0==this.srtt)return 3e3;var e=Math.min(1e3+500*this.lostR,3e3),t=this.srtt+4*this.sdev+350;return Math.min(t+e,8e3)}),a.prototype.update_SRTT_SDEV=function(e){var t;0==this.srtt?(this.srtt=e,this.sdev=e/2):(t=Math.abs(e-this.srtt),this.srtt=this.srtt*(1-s)+e*s,this.sdev=this.sdev+(t-this.sdev)*o)},a.prototype.updateQuota=function(e){e?(this.quota-=Math.sqrt(e/2),this.quota<2&&(this.quota=2)):this.quota<128&&0!=this.srtt&&this.srtt>1&&this.srtt<3e3&&(this.quota+=Math.log(this.srtt+500)/50)},a.prototype.onHeartbeat=function(e){if(!e.crc)return void this.peerMgr.removePeerNode(this,g.CRCErr);if(this.peerInfo.sourceID=e.sourceID,this.peerInfo.alias=e.alias,this.peerInfo.vid=e.vid,this.peerInfo.peerLocalID=e.localID,0==this.checked){if(b.has(e.localID))return void this.peerMgr.removePeerNode(this,g.doubleLink);b.set(e.localID,this),this.checked=!0}var t=v.getSegment(e.alias);if(t&&e.sourceID!=t.sourceID)return void this.peerMgr.removePeerNode(this,g.CRCErr);if(e.bitmap?(this.peerInfo.hasBitmap=!0,null==this.peerInfo.loadBitmap&&(this.peerInfo.loadBitmap=new d),this.peerInfo.loadBitmap.fromData(e.bitmap),v.hasSegment(this.peerInfo.loadBitmap.alias)&&this.peerInfo.loadBitmap.resetGap(v.getSegment(this.peerInfo.loadBitmap.alias).gpID)):this.peerInfo.hasBitmap=!1,e.preInfo.alias&&e.preInfo.sourceID){this.peerInfo.preInfo.alias=e.preInfo.alias,this.peerInfo.preInfo.sourceID=e.preInfo.sourceID;var r=v.getSegment(e.preInfo.alias);if(r&&e.preInfo.sourceID!=r.sourceID)return void this.peerMgr.removePeerNode(this,g.CRCErr)}else this.peerInfo.preInfo.alias="",this.peerInfo.preInfo.sourceID="";e.preInfo.bitmap?(this.peerInfo.preInfo.hasBitmap=!0,null==this.peerInfo.preInfo.loadBitmap&&(this.peerInfo.preInfo.loadBitmap=new d),this.peerInfo.preInfo.loadBitmap.fromData(e.preInfo.bitmap),this.peerInfo.preInfo.loadBitmap.resetGap(v.getSegment(this.peerInfo.preInfo.loadBitmap.alias).gpID)):this.peerInfo.preInfo.hasBitmap=!1,255!=e.lostR&&(this.peerInfo.lostR=e.lostR,0==this.peerInfo.lostR?this.mtu=Math.min(this.mtu+1,16):this.mtu=Math.max(this.mtu-Math.ceil(this.peerInfo.lostR/2),1))};var _={};return a.prototype.onRequest=function(e){if(!e.crc)return void this.peerMgr.removePeerNode(this,g.CRCErr);var t=e.alias;if(_.alias=t,_.sIDList?_.sIDList.length=0:_.sIDList=[],_.dataList?_.dataList.length=0:_.dataList=[],v.getSegment(t)){for(var r=v.getSegment(t),i=0;e.taskList.length>0;){var a=e.taskList.shift(),s=r.requestTask(a);s&&(i<this.mtu?(_.dataList[i]=s,_.sIDList[i]=a,i++):(l.pushTsk(this.peerID,n(_),this.timeout,i)&&(this.upHB+=i,this.upCnt+=i),_.dataList.length=0,_.sIDList.length=0,i=0,_.dataList[i]=s,_.sIDList[i]=a,i++))}_.dataList.length>0&&_.sIDList.length>0&&_.sIDList.length==_.dataList.length&&l.pushTsk(this.peerID,n(_),this.timeout,i)&&(this.upHB+=i,this.upCnt+=i)}},a.prototype.onReceive=function(e){if(!e.crc)return void this.peerMgr.removePeerNode(this,g.CRCErr);var t=v.getSegment(e.alias);if(t)for(var r,i;e.sIDList.length>0;)r=e.sIDList.shift(),i=e.alias.toString()+"_"+r.toString(),t.addSubPiece(r,e.dataList.shift()),this.rcvHB++,this.rcvCnt++,this.taskList.has(i)?(this.update_SRTT_SDEV(Date.now()-this.taskList.get(i).beginTime),this.taskList.remove(i)):this.update_SRTT_SDEV(this.timeout)},a.prototype.clearTask=function(){for(;this.taskList.size>0;){var e=this.taskList.remove();if(e){var t=v.getSegment(e.alias);t&&t.recycleP2PTask(e)}}this.fireData(p.clearTask,null)},a.prototype.onClearTask=function(e){e.crc?l.removeTsk(this.peerID):this.peerMgr.removePeerNode(this,g.CRCErr)},a.prototype.onRefuseTask=function(e){if(e.crc){for(;this.taskList.size>0;){var t=this.taskList.remove();if(t){var r=v.getSegment(t.alias);r&&r.recycleP2PTask(t)}}this.fireData(p.clearTask,null)}else this.peerMgr.removePeerNode(this,g.CRCErr)},a.prototype.onQuit=function(e){return e.crc?void this.peerMgr.removePeerNode(this,g.none):void this.peerMgr.removePeerNode(this,g.CRCErr)},a.prototype.fireSourceDescribe=function(){if(this.peerInfo.vid){var e=v.getSourceDescribe(this.peerInfo.vid);e&&e.byteLength>0&&this.fireData(p.peerDescribe,e)}},a.prototype.onDescribe=function(e){if(e.crc){if(e.describe){u.resetData(e.describe);var t=u.get16(),r=u.getCharStr(t);if(r!=v.loadSegment.vid)return;this.srcDscr.clear();for(var i=u.get16(),a=0;a<i;a++){t=u.get16();var n=new d;n.alias=u.get32(),n.size=u.get32(),n.data=u.getBytes(t-8),this.srcDscr.set(n.alias,n)}}}else this.peerMgr.removePeerNode(this,g.CRCErr)},a.prototype.checkHealth=function(e){if(this.rcvCnt<=0||this.srcDscr.size<=0)return!1;if(this.peerInfo&&this.peerInfo.hasBitmap&&this.peerInfo.alias==e)return this.peerInfo.loadBitmap.checkRange(v.getSegment(e).gpID,v.getSegment(e).gpID+8);if(this.srcDscr.has(e)){var t=this.srcDscr.get(e);if(t)return t.checkRange(v.getSegment(e).gpID,v.getSegment(e).gpID+8)}return!1},a.prototype.peerClose=function(e){this.rtc&&(""!=this.peerInfo.peerLocalID&&b.has(this.peerInfo.peerLocalID)&&(0==this.checked&&e==g.doubleLink||b.remove(this.peerInfo.peerLocalID)),this.clearTask(),this.close())},a.prototype.__defineGetter__("protected",function(){return Date.now()-this.createdTime<=3e4}),a.prototype.reset=function(){this.rcvHB=0,this.upHB=0},a.prototype.__defineGetter__("log",function(){function e(e,t){t||(t=1e3);var r=t.toString().substr(1),i=Math.ceil(e);return i>0&&(i+=t,r=i.toString().substr(1)),r}var t="";if(this.active)switch(this.dataChannelState){case"idle":t="idle ";break;case"open":t="open ";break;case"close":t="close";break;case"error":t="error"}else t="passv";return"[ "+t+" ] nat : "+e(this.natUseTime,1e6)+" , tkP : "+e(this.rcvHB)+" , tkC : "+e(this.rcvCnt,1e6)+" , asP : "+e(this.upHB)+" , asC : "+e(this.upCnt,1e6)+" , qta : "+e(Math.ceil(this.quota))+" , rtt : "+e(Math.ceil(this.srtt),1e4)+" , mtu : "+e(Math.ceil(this.mtu),100)+" , rto : "+e(Math.ceil(this.timeout),1e4)+" , lsP : "+e(Math.ceil(this.lostHB))+" , lsC : "+e(Math.ceil(this.lostCnt),1e4)}),a}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(){if(b=Date.now(),!(b<=v)){if(T=b-v,T>=u){D=1536,n(),v=b;var e=m/T;m=0,g+=(e-g)*l}b<=y||(T=b-y,T>0&&(y=b,s(Math.min(g+p/u,d/u)*T)))}}function n(){var e=0;for(var t in f)if(!t||f[t].time+f[t].rto+500<b){var r=f.splice(e,1)[0];p-=r.cont}else e++}function s(e){for(;p>0&&e>1;){var t=f.shift();if(p-=t.cont,e-=t.cont,t)try{S.has(t.id)&&S.get(t.id).dataChannel&&"open"==S.get(t.id).dataChannel.readyState&&S.get(t.id).dataChannel.send(t.args)}catch(e){}}}function o(e,t,r,i){return!(p>=d)&&(f.push({args:t,id:e,rto:r,time:b,cont:i}),p+=i,m+=i,!0)}function h(e){var t=0;for(var r in f)if(f[r].id==e){var i=f.splice(t,1)[0];p-=i.cont}else t++}var c=r(10),u=1e3,l=.25,d=512,f=[],p=0,g=.024,m=0,v=0,y=0,S=new c,b=-1,D=1536,T=0;return{check:a,get channelDict(){return S},set sendMax(e){d=e},pushTsk:o,removeTsk:h,checkTsk:n,get loadQuota(){return D},set loadQuota(e){D=e}}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(){return{version:0,receiveQuit:0,heartbeat:1,requestMediaData:2,receiveMediaData:3,clearTask:4,refuseTask:5,peerDescribe:6}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(){return{none:"0",peerFull:"1",frequentlyDataErr:"2",connectErr:"3",connectErrDirect:"4",natTimeOut:"5",checkTimeOut:"6",versionErr:"7",versionAK:"8",receiveQuit:"9",dead:"10",poorTunnel:"11",noData:"13",redundant:"14",CRCErr:"15",pieceSizeErr:"16",localDataCheckErr:"17",peerDataCheckErr:"18",doubleLink:"19"}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e,t,r,i){var n=this;this.peerMgr=e,this.active=r,this.peerID=t,this.quit=null,this.heartbeat=null,this.request=null,this.receive=null,this.clear=null,this.refuse=null,this.describe=null,this.dataChannel=null,this.dataChannelState="idle",this.timeStep=-1,this.lastEventTime=-1,this.alive=!0,this.rtc=new RTCPeerConnection({iceServers:[{url:a.stunIP}]}),this.connectionState="idle",this.workTime=0,this.natUseTime=0,this.natStartTime=-1,this.rtc.oniceconnectionstatechange=function(e){n.connectionState=e.currentTarget.iceConnectionState},this.rtc.onicecandidate=function(e){e.candidate&&n.peerMgr.candidate(n.peerID,e.candidate)},this.active?(this.getDataChannel(this.rtc.createDataChannel("dataCL"+_.toString(),{ordered:!1})),_++,this.rtc.createOffer(function(e){n.rtc.setLocalDescription(e),n.peerMgr.offer(n.peerID,e)},function(){n.dataChannelState="close",n.peerMgr.removePeerNode(n,T.connectErr)}),n.natStartTime=Date.now(),n.timeStep=setTimeout(function(){n.onNATTimeout.call(n)},1e4)):(this.rtc.setRemoteDescription(new RTCSessionDescription(i)),this.rtc.ondatachannel=function(e){n.getDataChannel(e.channel)},this.rtc.createAnswer(function(e){n.rtc.setLocalDescription(e),n.peerMgr.answer(n.peerID,e)},function(){n.dataChannelState="close",n.peerMgr.removePeerNode(n,T.connectErr)}),n.natStartTime=Date.now(),n.timeStep=setTimeout(function(){n.onNATTimeout.call(n)},8e3))}function n(e){return S.resetData(),S.set8(D.version),S.set8(D.receiveQuit),S.crc(),S.getReferData()}function s(e){return b.resetData(e),k.version=b.get8(),k.type=b.get8(),k.crc=b.crc(),k}function o(e){S.resetData(),S.set8(D.version),S.set8(D.heartbeat),S.set32(e.localID);var t=0;return null!=e.bitmap&&(t+=1),""!=e.preInfo.alias&&(t+=2),null!=e.preInfo.bitmap&&(t+=4),S.set8(t),S.set8(e.lostR),S.set8(e.vid.length),S.setCharStr(e.vid),S.set8(e.sourceID.length),S.setCharStr(e.sourceID),S.set32(e.alias),null!=e.bitmap&&(S.set8(e.bitmap.byteLength),S.setBytes(e.bitmap,0,e.bitmap.byteLength)),""!=e.preInfo.alias&&(S.set8(e.preInfo.sourceID.length),S.setCharStr(e.preInfo.sourceID),S.set32(e.preInfo.alias)),null!=e.preInfo.bitmap&&(S.set8(e.preInfo.bitmap.byteLength),S.setBytes(e.preInfo.bitmap,0,e.preInfo.bitmap.byteLength)),S.crc(),S.getReferData()}function h(e){b.resetData(e),w.version=b.get8(),w.type=b.get8(),w.localID=b.get32();var t=b.get8();w.lostR=b.get8();var r=b.get8();return w.vid=b.getCharStr(r),r=b.get8(),w.sourceID=b.getCharStr(r),w.alias=b.get32(),1&t?(r=b.get8(),w.bitmap=b.getBytes(r)):w.bitmap=null,2&t?(r=b.get8(),w.preInfo.sourceID=b.getCharStr(r),w.preInfo.alias=b.get32()):(w.preInfo.sourceID="",w.preInfo.alias=""),4&t?(r=b.get8(),w.preInfo.bitmap=b.getBytes(r)):w.preInfo.bitmap=null,w.crc=b.crc(),w}function c(e){if(e.length>0){for(S.resetData(),S.set8(D.version),S.set8(D.requestMediaData),S.set32(e[0].alias),S.set8(e.length);e.length>0;){var t=e.shift();S.set32(t.subPieceID)}return S.crc(),S.getReferData()}return null}function u(e){b.resetData(e),I.version=b.get8(),I.type=b.get8(),I.alias=b.get32(),I.taskLen=b.get8(),I.taskList||(I.taskList=[]),I.taskList.length=0;for(var t=0;t<I.taskLen;)I.taskList.push(b.get32()),t++;return I.crc=b.crc(),I}function l(e){b.resetData(e),P.version=b.get8(),P.type=b.get8(),P.alias=b.get32(),P.sIDList?P.sIDList.length=0:P.sIDList=[],P.dataList?P.dataList.length=0:P.dataList=[];for(var t=b.get8(),r=0;r<t;)P.sIDList[r]=b.get32(),P.dataList[r]=b.getBytes(y.subPieceSize),r++;return P.crc=b.crc(),P}function d(e){return S.resetData(),S.set8(D.version),S.set8(D.clearTask),S.crc(),S.getReferData()}function f(e){return b.resetData(e),C.version=b.get8(),C.type=b.get8(),C.crc=b.crc(),C}function p(e){return S.resetData(),S.set8(D.version),S.set8(D.refuseTask),S.crc(),S.getReferData()}function g(e){return b.resetData(e),L.version=b.get8(),L.type=b.get8(),L.crc=b.crc(),L}function m(e){return S.resetData(),S.set8(D.version),S.set8(D.peerDescribe),S.set16(e.byteLength),S.setBytes(e,0,e.byteLength),S.crc(),S.getReferData()}function v(e){b.resetData(e),E.version=b.get8(),E.type=b.get8();var t=b.get16();return E.describe=b.getBytes(t),E.crc=b.crc(),E}var y=r(8),S=r(11),b=r(29),D=r(36),T=r(37),_=0;a.stunIP="stun:220.181.184.90:3478",a.prototype.baseCheck=function(){return this.lastEventTime==-1||(this.alive=Date.now()-this.lastEventTime<1e4,!!this.alive||(this.peerMgr.removePeerNode(this,T.dead),!1))},a.prototype.fireData=function(e,t){if(this.ready){var r=null;switch(e){
case D.receiveQuit:if(r=n(t),r&&this.dataChannel&&"open"==this.dataChannel.readyState)try{this.dataChannel.send(r.buffer)}catch(e){}break;case D.heartbeat:if(r=o(t),r&&this.dataChannel&&"open"==this.dataChannel.readyState)try{this.dataChannel.send(r.buffer)}catch(e){}break;case D.requestMediaData:if(r=c(t),r&&this.dataChannel&&"open"==this.dataChannel.readyState)try{this.dataChannel.send(r.buffer)}catch(e){}break;case D.clearTask:if(r=d(t),r&&this.dataChannel&&"open"==this.dataChannel.readyState)try{this.dataChannel.send(r.buffer)}catch(e){}break;case D.refuseTask:if(r=p(t),r&&this.dataChannel&&"open"==this.dataChannel.readyState)try{this.dataChannel.send(r.buffer)}catch(e){}break;case D.peerDescribe:if(r=m(t),r&&this.dataChannel&&"open"==this.dataChannel.readyState)try{this.dataChannel.send(r.buffer)}catch(e){}}}};var k={},w={preInfo:{}},I={},P={},C={},L={},E={};return a.prototype.onData=function(e){if(e)if(e[0]!=D.version)this.peerMgr.removePeerNode(this,T.versionErr);else switch(this.lastEventTime=Date.now(),e[1]){case D.receiveQuit:this.quit&&this.quit(s(e));break;case D.heartbeat:this.heartbeat&&this.heartbeat(h(e));break;case D.requestMediaData:this.request&&this.request(u(e));break;case D.receiveMediaData:this.receive&&this.receive(l(e));break;case D.clearTask:this.clear&&this.clear(f(e));break;case D.refuseTask:this.refuse&&this.refuse(g(e));break;case D.peerDescribe:this.describe&&this.describe(v(e))}},a.prototype.getDataChannel=function(e){var t=this;this.dataChannel=e,this.dataChannel.onopen=function(){0==t.workTime&&(t.workTime=Date.now()),0==t.natUseTime&&(t.natUseTime=Date.now()-t.natStartTime),t.dataChannelState="open",clearTimeout(t.timeStep),t.lastEventTime=Date.now()},this.dataChannel.onclose=function(){t.dataChannelState="close",t.peerMgr.removePeerNode(t,T.connectErr)},this.dataChannel.onerror=function(e){t.dataChannelState="error",t.peerMgr.removePeerNode(t,T.connectErr)},this.dataChannel.onmessage=function(e){t.onData(new Uint8Array(e.data))}},a.prototype.close=function(){clearTimeout(self.timeStep),this.ready&&this.fireData(D.clearTask),this.dataChannel&&(this.dataChannel.close(),this.dataChannel=null);try{this.rtc&&("closed"!=this.rtc.signalingState&&this.rtc.close(),this.rtc=null)}catch(e){}},a.prototype.offer=function(e){},a.prototype.answer=function(e){this.rtc.setRemoteDescription(new RTCSessionDescription(e))},a.prototype.candidate=function(e){this.rtc.addIceCandidate(new RTCIceCandidate(e))},a.prototype.onNATTimeout=function(){this.peerMgr.removePeerNode(this,T.natTimeOut)},a.prototype.__defineGetter__("ready",function(){return("completed"==this.connectionState||"connected"==this.connectionState)&&"open"==this.dataChannelState}),a}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){var a=r(16),n=r(40),s=r(42),o=r(1);return{reset:function(e,t,r){this.readOrder=e,this.readTime=t,this.readPosition=-1,r||(this.videoTime=0,this.audioTime=0,this.videoSequence=0,this.audioSequence=0,this.timeStep=0),this.keyFrame=!0,this.fragmentEOF=!1,this.readEndTime=-1,this.mp4Data={video:{has:!1,duration:0,endTime:0,data:null,head:null},audio:{has:!1,duration:0,endTime:0,data:null,head:null}}},resetData:function(){this.mp4Data={video:{has:!1,duration:0,endTime:0,data:null,head:null},audio:{has:!1,duration:0,endTime:0,data:null,head:null}}},packetFMP4:function(e,t,r){var i=e.flvInfo,h=a.parseData(t);if(h.dataLen<=0||i.hasVideo&&!this.keyFrame&&h.video.list.length<12||i.hasAudio&&!this.keyFrame&&h.audio.list.length<16)return!1;if(r||null==this.mp4Data.video.head||null==this.mp4Data.audio.head){if(this.mp4Data.video.has=i.hasVideo,this.mp4Data.video.has&&(i.videoConfigTag.head||(i.videoConfigTag.head=s.generateInitSegment(i.videoConfigTag)),this.mp4Data.video.head=i.videoConfigTag,i.videoConfigTag.timeStep=0),this.mp4Data.audio.has=i.hasAudio,this.mp4Data.audio.has&&(i.audioConfigTag.head||(i.audioConfigTag.head=s.generateInitSegment(i.audioConfigTag)),this.mp4Data.audio.head=i.audioConfigTag,i.audioConfigTag.timeStep=0),n.hasVideo!=-1&&!!n.hasVideo!=this.mp4Data.video.has||n.hasAudio!=-1&&!!n.hasAudio!=this.mp4Data.audio.has||n.currentTime>=18e4&&!e.isAD&&""!=n.videoTVID&&n.videoTVID!=e.tvId)return n.needClear=!0,!1;this.mp4Data.audio.has&&this.mp4Data.video.has&&(this.timeStep=h.audio.time-this.audioTime-(h.video.time-this.videoTime))}if(this.mp4Data.video.has&&h.video.list.length>0){if(this.timeStep<0&&(Math.abs(this.timeStep)>=h.video.list.length?(this.mp4Data.video.head.timeStep=h.video.list.length,this.timeStep+=h.video.list.length):(this.mp4Data.video.head.timeStep=Math.abs(this.timeStep),this.timeStep=0)),o.forceFirstIDR){var c=h.video.list[0].flags;c.dependsOn=2,c.isNonSync=0}var u=s.moof(h.video.list,this.videoSequence,this.mp4Data.video.head,this.videoTime);this.videoSequence++,this.mp4Data.video.head.timeStep=0,this.mp4Data.video.sampleCount=h.video.list.length;var l=new Uint8Array(h.video.dataLen+8);l[0]=h.video.dataLen+8>>>24&255,l[1]=h.video.dataLen+8>>>16&255,l[2]=h.video.dataLen+8>>>8&255,l[3]=h.video.dataLen+8&255,l.set(s.types.mdat,4);for(var d=8;h.video.list.length>0;){var f=h.video.list.shift();l.set(f.NALUData,d),d+=f.NALUData.byteLength}this.mp4Data.video.data=new Uint8Array(u.byteLength+l.byteLength),this.mp4Data.video.data.set(u,0),this.mp4Data.video.data.set(l,u.byteLength),this.mp4Data.video.duration=this.mp4Data.video.head.tmpDuration,this.videoTime+=this.mp4Data.video.duration,this.readTime=h.video.time,this.mp4Data.video.endTime=this.readEndTime=h.video.endTime}if(h.audio.list.length>0){this.timeStep>0&&(Math.abs(this.timeStep)>=h.audio.list.length?(this.mp4Data.audio.head.timeStep=h.audio.list.length,this.timeStep-=h.audio.list.length):(this.mp4Data.audio.head.timeStep=Math.abs(this.timeStep),this.timeStep=0));var p=s.moof(h.audio.list,this.audioSequence,this.mp4Data.audio.head,this.audioTime);this.audioSequence++,this.mp4Data.audio.head.timeStep=0,this.mp4Data.audio.sampleCount=h.audio.list.length;var g=new Uint8Array(h.audio.dataLen+8);g[0]=h.audio.dataLen+8>>>24&255,g[1]=h.audio.dataLen+8>>>16&255,g[2]=h.audio.dataLen+8>>>8&255,g[3]=h.audio.dataLen+8&255,g.set(s.types.mdat,4);for(var m=8;h.audio.list.length>0;){var v=h.audio.list.shift();g.set(v.NALUData,m),m+=v.NALUData.byteLength}this.mp4Data.audio.data=new Uint8Array(p.byteLength+g.byteLength),this.mp4Data.audio.data.set(p,0),this.mp4Data.audio.data.set(g,p.byteLength),this.mp4Data.audio.duration=this.mp4Data.audio.head.tmpDuration,this.audioTime+=this.mp4Data.audio.duration,this.mp4Data.video.has||(this.readTime=h.audio.time,this.mp4Data.audio.endTime=this.readEndTime=h.audio.endTime)}return this.mp4Data.eof=this.fragmentEOF,this.mp4Data.segment=e,this.readPosition+=h.dataLen,!0}}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e,t){P=e,P.pause(),I=t,J=Date.now()}function n(e){e?P=e:(l(!1),P=null)}function s(){P&&!U&&N!=T.playState_stop&&(R=!0,L&&!P.paused&&P.pause(),A.systemTime>0&&(A.videoTime=A.time,A.systemTime=0),I.call(null,T.playState_pause,"",""))}function o(){P&&!U&&N!=T.playState_stop&&(R=!1,0==q?(L&&P.paused&&P.play(),N=T.playState_playing,clearTimeout(V),V=0,V=setTimeout(v,5e3),0==A.systemTime&&(A.systemTime=Date.now()),I.call(null,T.playState_playing,"","")):q>0?(N=T.playState_waiting,A.systemTime>0&&(A.videoTime=A.time,A.systemTime=0),I.call(null,T.playState_waiting,"","")):L&&P.paused&&P.play())}function h(){q>0||(0!=K.length&&K[K.length-1].duration==-1||K.push({time:Date.now(),duration:-1}),q=Date.now(),F?N!=T.playState_stop&&(N=T.playState_stop,A.systemTime>0&&(A.videoTime=A.time,A.systemTime=0),I.call(null,T.playState_stop,"","")):(!L||R||P.paused||P.pause(),N!=T.playState_waiting&&(N=T.playState_waiting,A.systemTime>0&&(A.videoTime=A.time,A.systemTime=0),I.call(null,T.playState_waiting,"",""))))}function c(){0!=q&&(K.length>0&&K[K.length-1].duration==-1&&(K[K.length-1].duration=Date.now()-K[K.length-1].time),q>0&&_.check({rec:"full",dura:Date.now()-q}),q=0,!R&&P.paused&&P.play(),N!=T.playState_playing&&(N=T.playState_playing,0==A.systemTime&&(A.systemTime=Date.now()),I.call(null,T.playState_playing,"","")))}function u(){z?z.eof=!0:j.eof=!0}function l(e,t,r){if(P){if(Q=Date.now(),X=0,M.sourceBuffer){try{M.sourceBuffer.abort()}catch(e){}try{C&&C.removeSourceBuffer(M.sourceBuffer)}catch(e){}}if(x.sourceBuffer){try{x.sourceBuffer.abort()}catch(e){}try{C&&C.removeSourceBuffer(x.sourceBuffer)}catch(e){}if("open"===C.readyState)try{C.endOfStream()}catch(e){}}if(C)try{C.removeEventListener("sourceopen",d),C.removeEventListener("sourceclose",f)}catch(e){}M={has:-1,head:null,data:null,sourceBuffer:null,bufStart:0,bufEnd:0,buffer:0,expBuf:0},x={has:-1,head:null,data:null,sourceBuffer:null,bufStart:0,bufEnd:0,buffer:0,expBuf:0},q>0&&K[K.length-1]&&K[K.length-1].duration==-1&&(K[K.length-1].duration=Date.now()-K[K.length-1].time),t!=-1&&r!=-1&&(A=new w(t,r)),j={segment:null,endTime:-1},z=null,G=-1,H=0,O=0,E=!1,L=!1,U=!1,B=!1,q=-1,W="",clearTimeout(V),V=0,N=T.playState_waiting;try{P.removeEventListener("error",p),P.src="",P.removeAttribute("src"),P.removeEventListener("timeupdate",g)}catch(e){}if(e){C=new MediaSource,C.addEventListener("sourceopen",d),C.addEventListener("sourceclose",f);try{P.src=window.URL.createObjectURL(C),P.pause(),P.addEventListener("error",p),P.addEventListener("timeupdate",g)}catch(e){y("createMediaSourceError")}}}}function d(e){B=!0}function f(e){P&&(B=!0,y("onMediaSourceEventError"))}function p(e){P&&y("onVideoEventError")}function g(e){if((!(Date.now()-Z<100)||E||"updateend"==e)&&(Z=Date.now(),e&&(clearTimeout(V),V=0,V=setTimeout(v,5e3)),P&&!U&&N!=T.playState_stop&&N!=T.decoderState_error)){if(1==M.has&&M.sourceBuffer&&M.sourceBuffer.buffered&&!M.sourceBuffer.updating){if(M.sourceBuffer.buffered.length>1){for(var t="",r=0;r<M.sourceBuffer.buffered.length;r++)t+="    start : "+M.sourceBuffer.buffered.start(r)+" , end : "+M.sourceBuffer.buffered.end(r)+"\r\n";return void y("video-multiBufferError-"+M.sourceBuffer.buffered.length)}1==M.sourceBuffer.buffered.length?(M.bufStart=M.sourceBuffer.buffered.start(0),M.bufEnd=M.sourceBuffer.buffered.end(0),P.currentTime-M.bufStart>40&&M.sourceBuffer.remove(0,P.currentTime-10),O=M.bufEnd-P.currentTime):M.bufStart=M.bufEnd=0}if(1==x.has&&x.sourceBuffer&&x.sourceBuffer.buffered&&!x.sourceBuffer.updating){if(x.sourceBuffer.buffered.length>1){for(var i="",a=0;a<x.sourceBuffer.buffered.length;a++)i+="    start : "+x.sourceBuffer.buffered.start(a)+" , end : "+x.sourceBuffer.buffered.end(a)+"\r\n";return void y("audio-multiBufferError-"+x.sourceBuffer.buffered.length)}1==x.sourceBuffer.buffered.length?(x.bufStart=x.sourceBuffer.buffered.start(0),x.bufEnd=x.sourceBuffer.buffered.end(0),O=1==M.has?Math.max(0,Math.min(M.bufEnd,x.bufEnd)-P.currentTime):Math.max(0,x.bufEnd-P.currentTime)):x.bufStart=x.bufEnd=0}if(L){if(j.segment&&j.eof&&!R&&(q>0||j.endTime!=-1&&P.currentTime>=j.endTime-.1)&&(I.call(null,T.playState_endFragment,j.segment.order+"_"+j.segment.vid+"_"+j.segment.index,j.dataEndTime),z?(A.segment=z.segment,A.videoTime=z.dataEndTime-z.duration,A.videoTime<0&&(A.videoTime=0),0!=A.systemTime&&(A.systemTime=Date.now()),j.segment=z.segment,j.endTime=z.duration/1e3+(0==M.has?M.bufEnd:x.bufEnd),I.call(null,T.playState_startFragment,j.segment.order+"_"+j.segment.vid+"_"+j.segment.index,z.dataEndTime-z.duration),z=null):j={segment:null,endTime:-1}),R||0!=q)G=-1;else if(G<P.currentTime)G==-1&&(G=P.currentTime),D.playDuration+=P.currentTime-G,X+=P.currentTime-G,G=P.currentTime,H=0;else if(H++,H>=25)return G=-1,H=0,void y("onVideoStuckError");0==q?O<.1&&h():q>0&&O>2&&c()}else O>=.5&&(L=!0,I.call(null,T.playState_ready,"",""),c())}}function m(e){P&&(e.segment.isAD||(W=e.segment.tvId),e.video.has?(null===j.segment||j.segment===e.segment?(null===j.segment&&I.call(null,T.playState_startFragment,e.segment.order+"_"+e.segment.vid+"_"+e.segment.index,e.video.endTime-e.video.duration),A.segment=e.segment,A.videoTime=e.video.endTime-e.video.duration-1e3*(M.bufEnd-P.currentTime),A.videoTime<0&&(A.videoTime=0),A.systemTime>0&&(A.systemTime=Date.now()),j.segment=e.segment,j.eof=e.eof,j.dataEndTime=e.video.endTime,j.endTime=e.video.duration/1e3+M.bufEnd):(z={},z.eof=e.eof,z.segment=e.segment,z.duration=e.video.duration,z.dataEndTime=e.video.endTime),M.has=1,M.expBuf=M.bufEnd,e.video.duration>=600&&(M.expBuf+=e.video.duration/2e3),M.sourceBuffer?M.head&&M.head!=e.video.head?(M.head=e.video.head,M.sourceBuffer.appendBuffer(M.head.head.buffer),M.data=e.video.data):M.sourceBuffer.appendBuffer(e.video.data.buffer):(M.head=e.video.head,M.sourceBuffer=C.addSourceBuffer('video/mp4; codecs="'+M.head.codec+'"'),M.sourceBuffer.addEventListener("error",function(e){P&&y("Video-onSourceBufferError")}),M.sourceBuffer.addEventListener("updateend",function(e){if(P&&(g("updateend"),M.sourceBuffer&&!M.sourceBuffer.updating&&M.data))try{M.sourceBuffer.appendBuffer(M.data.buffer),M.data=null}catch(e){}}),M.sourceBuffer.appendBuffer(M.head.head.buffer),M.data=e.video.data)):M.has=0,e.audio.has?(e.video.has||(null===j.segment||j.segment===e.segment?(null===j.segment&&I.call(null,T.playState_startFragment,e.segment.order+"_"+e.segment.vid+"_"+e.segment.index,e.audio.endTime-e.audio.duration),A.segment=e.segment,A.videoTime=e.audio.endTime-e.audio.duration-1e3*O,A.videoTime<0&&(A.videoTime=0),0!=A.systemTime&&(A.systemTime=Date.now()),j.segment=e.segment,j.eof=e.eof,j.dataEndTime=e.audio.endTime,j.endTime=e.audio.duration/1e3+x.bufEnd):(z={},z.eof=e.eof,z.segment=e.segment,z.duration=e.audio.duration,z.dataEndTime=e.audio.endTime)),x.has=1,x.expBuf=x.bufEnd,!e.video.has&&e.audio.duration>=600&&(x.expBuf+=e.audio.duration/2e3),x.sourceBuffer?x.head&&x.head!=e.audio.head?(x.head=e.audio.head,x.sourceBuffer.appendBuffer(x.head.head.buffer),x.data=e.audio.data):x.sourceBuffer.appendBuffer(e.audio.data.buffer):(x.head=e.audio.head,x.sourceBuffer=C.addSourceBuffer("audio/mp4; codecs="+x.head.codec),x.sourceBuffer.addEventListener("error",function(e){P&&y("Audio-onSourceBufferError")}),x.sourceBuffer.addEventListener("updateend",function(e){if(P&&(g("updateend"),x.sourceBuffer&&!x.sourceBuffer.updating&&x.data))try{x.sourceBuffer.appendBuffer(x.data.buffer),x.data=null}catch(e){}}),x.sourceBuffer.appendBuffer(x.head.head.buffer),x.data=e.audio.data)):x.has=0)}function v(){R||N!=T.playState_playing||(clearTimeout(V),V=0,y("lagTimeUpdate"))}function y(e){Y=Date.now(),j.segment&&j.eof&&I.call(null,T.playState_endFragment,j.segment.order+"_"+j.segment.vid+"_"+j.segment.index,j.dataEndTime),k.error("videoDecoder [ERROR] msg : "+e),U=!0,N!=T.decoderState_error&&(N=T.decoderState_error,A.systemTime>0&&(A.videoTime=A.time,A.systemTime=0),I.call(null,T.decoderState_error,e,Math.floor((Date.now()-J)/1e3)+"-"+Math.floor((Date.now()-Q)/1e3)+"-"+Math.floor(X/1e3)))}function S(){return P&&null==P.error&&B&&Date.now()-Y>1e3&&!F&&!E&&!U&&Date.now()-Z>=100&&null==M.data&&null==x.data&&null==z&&M.bufEnd>=M.expBuf&&x.bufEnd>=x.expBuf&&(null==M.sourceBuffer||M.sourceBuffer&&!M.sourceBuffer.updating)&&(null==x.sourceBuffer||x.sourceBuffer&&!x.sourceBuffer.updating)}function b(){var e=5e3;for(var t in K)Date.now()-K[t].time<3e5&&(e+=1500);return Math.min(e,3e4)}var D=r(6),T=r(4),_=r(5),k=r(2),w=r(41),I=null,P=null,C=null,L=!1,E=!1,B=!1,O=0,M={has:-1,head:null,data:null,sourceBuffer:null,bufStart:0,bufEnd:0,buffer:0,expBuf:0},x={has:-1,head:null,data:null,sourceBuffer:null,bufStart:0,bufEnd:0,buffer:0,expBuf:0},A=new w(0,0),j={segment:null,endTime:-1},z=null,R=!0,U=!1,F=!1,N=T.playState_waiting,G=-1,H=0,V=0,q=-1,K=[],W="",J=-1,Q=-1,X=0,Y=-1,Z=-1;return{get encodeBuffer(){return 1e3*O},get bufferStart(){return 1e3*(1==M.has?M.bufStart:x.bufStart)},get bufferEnd(){return 1e3*(1==M.has?M.bufEnd:x.bufEnd)},get currentTime(){return P?1e3*P.currentTime:0},get bufferTime(){return q<=0?0:b()},get videoPointer(){return A},get error(){return U},get paused(){return R},get waiting(){return 0!=q},set eof(e){F=e},get eof(){return F},get canAppend(){return S()},set state(e){N=e},get state(){return N},set videoTVID(e){W=e},get videoTVID(){return W},set needClear(e){E=e},//!!
get needClear(){return E},get hasVideo(){return M.has},get hasAudio(){return x.has},reset:n,init:a,pause:s,resume:o,appendBuffer:m,clear:l,beEnd:u}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,r){function i(e,t){this._order=e,this.segment=null,this.systemTime=0,this.videoTime=t}return i.prototype.__defineGetter__("time",function(){return Math.max(0,Math.ceil(this.videoTime+(this.systemTime>0?Date.now()-this.systemTime:0)))}),i.prototype.__defineGetter__("order",function(){return this.segment?this.segment.order:this._order}),i}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,r){function i(e){for(var t=8,r=Array.prototype.slice.call(arguments,1),i=r.length,a=0;a<i;a++)t+=r[a].byteLength;var n=new Uint8Array(t);n[0]=t>>>24&255,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n.set(e,4);for(var s=8,o=0;o<i;o++)n.set(r[o],s),s+=r[o].byteLength;return n}function a(e){var t=i(I.ftyp,C.FTYP),r=n(e),a=new Uint8Array(t.byteLength+r.byteLength);return a.set(t,0),a.set(r,t.byteLength),a}function n(e){var t=s(e.timescale,e.duration),r=o(e),a=S(e);return i(I.moov,t,r,a)}function s(e,t){return i(I.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}function o(e){return i(I.trak,h(e),c(e))}function h(e){var t=e.id,r=e.duration,a=0,n=0;return"video"==e.type&&(a=e.sps.present_size.width,n=e.sps.present_size.height),i(I.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>>8&255,255&a,0,0,n>>>8&255,255&n,0,0]))}function c(e){return i(I.mdia,u(e),l(e),d(e))}function u(e){var t=e.timescale,r=e.duration;return i(I.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,r>>>24&255,r>>>16&255,r>>>8&255,255&r,85,196,0,0]))}function l(e){var t=null;return t="audio"http://static.iqiyi.com/js/player_v1/res/20170713/===e.type?C.HDLR_AUDIO:C.HDLR_VIDEO,i(I.hdlr,t)}function d(e){var t=null;return t="audio"http://static.iqiyi.com/js/player_v1/res/20170713/===e.type?i(I.smhd,C.SMHD):i(I.vmhd,C.VMHD),i(I.minf,t,f(),p(e))}function f(){return i(I.dinf,i(I.dref,C.DREF))}function p(e){return i(I.stbl,g(e),i(I.stts,C.STTS),i(I.stsc,C.STSC),i(I.stsz,C.STSZ),i(I.stco,C.STCO))}function g(e){return"audio"===e.type?i(I.stsd,C.STSD_PREFIX,m(e)):i(I.stsd,C.STSD_PREFIX,y(e))}function m(e){var t=e.channelCount,r=e.sampleRate,a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t,0,16,0,0,0,0,r>>>8&255,255&r,0,0]);return i(I.mp4a,a,v(e))}function v(e){var t=e.config,r=t.length,a=new Uint8Array([0,0,0,0,3,23+r,0,1,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([r]).concat(t).concat([6,1,2]));return i(I.esds,a)}function y(e){var t=e.AVCPacketData,r=e.sps.codec_size.width,a=e.sps.codec_size.height,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,r>>>8&255,255&r,a>>>8&255,255&a,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return i(I.avc1,n,i(I.avcC,t))}function S(e){return i(I.mvex,b(e))}function b(e){var t=e.id,r=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return i(I.trex,r)}function D(e,t,r,a){return i(I.moof,T(t),_(e,r,a))}function T(e){var t=new Uint8Array([0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e]);return i(I.mfhd,t)}function _(e,t,r){var a=t.id,n=i(I.tfhd,new Uint8Array([0,0,0,0,a>>>24&255,a>>>16&255,a>>>8&255,255&a])),s=i(I.tfdt,new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r])),o=k(e,t),h=w(e,t,o.byteLength+16+16+8+16+8+8);return i(I.traf,n,s,h,o)}function k(e,t){for(var r=e.length,a=new Uint8Array(4+r),n=0;n<r;n++){var s=e[n].flags;a[n+4]=s.isLeading<<6|s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy}return i(I.sdtp,a)}function w(e,t,r){var a=e.length,n=12+16*a,s=new Uint8Array(n);r+=8+n,s.set([0,0,15,1,a>>>24&255,a>>>16&255,a>>>8&255,255&a,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),t.tmpDuration=0;for(var o=0;o<a;o++){var h=e[o].duration==-1?t.sampleDuration:e[o].duration;t.timeStep>0&&(h+=1,t.timeStep-=1),t.tmpDuration+=h;var c=e[o].NALUData.byteLength,u=e[o].flags,l=e[o].CompositionTime;s.set([h>>>24&255,h>>>16&255,h>>>8&255,255&h,c>>>24&255,c>>>16&255,c>>>8&255,255&c,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.isNonSync,0,0,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*o)}return i(I.trun,s)}var I={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};for(var P in I)I.hasOwnProperty(P)&&(I[P]=[P.charCodeAt(0),P.charCodeAt(1),P.charCodeAt(2),P.charCodeAt(3)]);var C={};return C.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),C.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),C.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),C.STSC=C.STCO=C.STTS,C.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),C.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),C.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),C.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),C.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),C.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),{types:I,constants:C,generateInitSegment:a,moof:D}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e,t){U||B||(R=e,U=t,E=0,M=0,x=0,A=-1,j=0,O=Date.now(),clearTimeout(C),C=0,C=setTimeout(n,l()),k.load(o,R,U),w.addPBItem(P.cdn_taskCnt))}function n(){U&&!B&&(v++,o(_.LoaderState_error,_.LoaderState_error_dispatch,"timeout",Date.now()-O))}function s(){U&&!B&&(L?(D++,o(_.LoaderState_error,_.LoaderState_error_load,"revTimeout",Date.now()-O)):(S++,o(_.LoaderState_error,_.LoaderState_error_load,"ttfbTimeout",Date.now()-O)))}function o(e,t,r,i){if(U&&!B)switch(e){case _.LoaderState_ready:clearTimeout(C),C=0,C=setTimeout(s,d());break;case _.LoaderState_progress:clearTimeout(C),C=0,C=setTimeout(s,f()),h(t,r,i);break;case _.LoaderState_done:clearTimeout(C),C=0,c();break;case _.LoaderState_error:u(t,r,i)}}function h(e,t,r){if(L||(w.addPBItem(P.cdn_progressCnt),w.addPBItem(P.cdn_progressTime,Date.now()-O),L=!0),w.addPBItem(P.cdn_loadTime,Date.now()-O),O=Date.now(),j+=r,A==-1)A=Date.now();else if(Date.now()-A>1e3&&(M=Math.ceil(j/(Date.now()-A)),R.isAD||I.updatePreIDC(M,R.idc,R.ip,R.ws),I.cdnSpeed=M,j=0,A=Date.now(),M<R.rate?x++:x--,x>6)){I.preidc&&I.preidc.idc==R.idc&&I.updatePreIDC(0,"","",!1),I.cdnSpeed=0,x=0;var i=R.isAD?0:R.checkP2PHealth();if(i>=3+Math.ceil(M/100))return F="load-lowSpeed-"+R.idc+"-"+R.ip,N=R.sourceID,p(!0),R.setOnP2P(15e3),void T.info("start pure P2P state! health peers : "+i+" , cdnSpeed : "+M+" , byteRate : "+R.rate);if(M<R.rate/3)return void u(_.LoaderState_error_load,"lowSpeed","")}r>0&&(R.pushData(e,t,r)||u(_.LoaderState_error_parseKf,"",""))}function c(){L||(w.addPBItem(P.cdn_progressCnt),w.addPBItem(P.cdn_progressTime,Date.now()-O)),w.addPBItem(P.cdn_loadTime,Date.now()-O),O=Date.now(),I.cdnSpeed=0,U=null,clearTimeout(C),C=0,L=!1,E=0,M=0,x=0,A=-1,j=0,k.running&&k.close(!1)}function u(e,t,r){var i=!1;switch(e){case _.LoaderState_error_dispatch:F="dispatch-"+t,N=R.sourceID,R.stateChangeFun.call(R,_.playState_loadState,{loadType:"dispatch",activeType:"error",url:k.url,retryCount:E.toString(),msg:F}),w.check({rec:"loadErr",etyp:_.LoaderState_error_dispatch}),T.error("load [Error] type : "+e+" , detail : "+t+" , retryCnt : "+E+" , msg : "+r);break;case _.LoaderState_error_load:if("fromStart"==t)return p(!0),void a(R,[{begin:0,end:R.size}]);I.preidc&&I.preidc.idc==R.idc&&I.updatePreIDC(0,"","",!1),I.cdnSpeed=0,F="load-"+t+"-"+R.idc+"-"+R.ip,N=R.sourceID,w.check({rec:"loadErr",etyp:_.LoaderState_error_load,ip:R.ip,area:R.idc}),R.errIDCList.indexOf(R.idc)==-1&&R.errIDCList.push(R.idc),"accessErr"==t&&"websocket"http://static.iqiyi.com/js/player_v1/res/20170713/!=I.loadType&&R.ws?(w.check({rec:"loadErr",etyp:"switchwebsocket",ip:R.ip,area:R.idc}),I.loadType="websocket",i=!0):"websocket"==I.loadType&&(I.loadType="fetch"),R.stateChangeFun.call(R,_.playState_loadState,{loadType:"cache",netType:"websocket"==I.loadType?"websocket":"http",activeType:"error",url:k.url,retryCount:E.toString(),msg:F}),T.error("load [Error] range url : "+R.dataUrl+" , type : "+e+" , detail : "+t+" , retryCnt : "+E+" , msg : "+r);break;case _.LoaderState_error_parseKf:I.preidc&&I.preidc.idc==R.idc&&I.updatePreIDC(0,"","",!1),I.cdnSpeed=0,F="parsekf-"+R.idc+"-"+R.ip,N=R.sourceID,w.check({rec:"loadErr",etyp:_.LoaderState_error_parseKf,ip:R.ip,area:R.idc}),R.errIDCList.indexOf(R.idc)==-1&&R.errIDCList.push(R.idc),R.stateChangeFun.call(R,_.playState_loadState,{loadType:"cache",netType:"websocket"==I.loadType?"websocket":"http",activeType:"error",url:k.url,retryCount:E.toString(),msg:F}),T.error("load [Error] range url : "+R.dataUrl+" , type : "+e+" , detail : "+t+" , retryCnt : "+E+" , msg : "+r);break;default:T.error("load [Error] type : "+e+" , detail : "+t+" , retryCnt : "+E+" , msg : "+r)}if(clearTimeout(C),C=0,L=!1,!R.isAD&&R.checkP2PHealth()>=4)return p(!0),void R.setOnP2P(15e3);if(M=0,x=0,A=-1,j=0,i||(R.dataUrl="",E++),E>y.length)return E=0,k.running&&k.close(!0),R.isAD||R.recycleCDNTask(U),U=null,B=!0,T.error("load [FINAL Error]!!!"),void z.call(R,e,t,r);O=Date.now(),w.addPBItem(P.cdn_taskCnt);var s;s=R.isAD?R.checkTask():R.checkTask(U[0].begin,U[U.length-1].end),s&&0!=s.length?(k.running&&k.close(!0),U=s,clearTimeout(C),C=0,C=setTimeout(n,l()),k.load(o,R,U)):c()}function l(){return R.isAD?(v<m.length?m[v]:m[m.length-1])+3e3:v<m.length?m[v]:m[m.length-1]}function d(){return R.isAD?(S<y.length?y[S]:y[y.length-1])+3e3:S<y.length?y[S]:y[y.length-1]}function f(){return R.isAD?(D<b.length?b[D]:b[b.length-1])+3e3:D<b.length?b[D]:b[b.length-1]}function p(e){U&&!R.isAD&&R.recycleCDNTask(U),U=null,clearTimeout(C),C=0,L=!1,O=0,E=0,M=0,x=0,A=-1,j=0,k.running&&k.close(!0),e||(B=!1)}function g(){var e="";return R&&R.sourceID==N&&(e=R.isAD?"AD-"+F:F),"urgencyP2P"==k.loadStage?"urgencyP2P-lastErr-"+e:null==U?"idle-lastErr-"+e:"CDN"==k.loadStage?"CDN-"+R.idc+"-"+R.ip+"-"+M+"-"+R.rate+"-lastErr-"+e:"dispatch"==k.loadStage?"dispatch-lastErr-"+e:"idle-lastErr-"+e}var m=[1e3,2e3,5e3],v=0,y=[2e3,4e3,5e3,6e3],S=0,b=[3e3,4e3,5e3,6e3],D=0,T=(r(8),r(2)),_=(r(3),r(4)),k=r(44),w=r(5),I=r(6),P=r(12),C=0,L=!1,E=0,B=!1,O=0,M=0,x=0,A=-1,j=0,z=null,R=null,U=null,F="",N="";return{load:a,clear:p,get running(){return null!=U},get speed(){return M},set cdnErrFun(e){z=e},set dispatchCfg(e){m=e},set TTFBCfg(e){y=e},get loadStage(){return k.loadStage},set loadStage(e){k.loadStage=e},get loadInfo(){return g()}}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e,t,r){D&&u(!1),b=e,D=t,n(),y=l.mixin([],r,!0,!1),S=null,D.dataUrl?(w="CDN",b.call(null,g.LoaderState_ready),h()):(w="dispatch"http://static.iqiyi.com/js/player_v1/res/20170713/,p.start(s,o,D),k=p.url)}function n(){d.loadType==m.type?(_=m,_.init(c)):_=new v(c),p.clear()}function s(){D&&(D.ws||d.loadType!=m.type||(d.loadType=v.type,n()),b.call(null,g.LoaderState_ready),w="CDN",h())}function o(e){D&&(u(!0),b.call(null,g.LoaderState_error,g.LoaderState_error_dispatch,e,""))}function h(){if(D)if(0!=y.length||S)if(D.dataUrl){S=y.shift();var e=l.getPureIP(D.dataUrl),t=D.dataUrl.indexOf(e),r=D.dataUrl.indexOf(".f4v");S.path=D.dataUrl.slice(t+e.length,r+4),S.url=D.dataUrl,S.rate=D.rate,S.ip=e+":80"http://static.iqiyi.com/js/player_v1/res/20170713/,S.segment=D,S.data=null,k=S.url;try{d.loadType==m.type?D.stateChangeFun.call(D,g.playState_loadState,{loadType:"cache",netType:"websocket",activeType:"start",url:S.url}):D.stateChangeFun.call(D,g.playState_loadState,{loadType:"cache",netType:"http",activeType:"start",url:S.url}),T=Date.now(),f.info("load [START] "+S.url),_.load(S)}catch(e){D&&(u(!0),b.call(null,g.LoaderState_error,g.LoaderState_error_load,"trycatchError",""))}}else p.start(s,o,D),k=p.url;else w="",u(!1),b.call(null,g.LoaderState_done)}function c(e,t){if(D)switch(e){case"progress":b.call(null,g.LoaderState_progress,S.data,S.range.begin,S.range.end-S.range.begin);break;case"done":d.loadType==m.type?D.stateChangeFun.call(D,g.playState_loadState,{loadType:"cache",netType:"websocket",activeType:"done",url:S.url,duration:(Date.now()-T).toString()}):D.stateChangeFun.call(D,g.playState_loadState,{loadType:"cache",netType:"http",activeType:"done",url:S.url,duration:(Date.now()-T).toString()}),f.info("load [DONE] range : "+S.begin+"-"+S.end+" , sourceID : "+S.path),S=null,h();break;case"error":u(!0),b.call(null,g.LoaderState_error,g.LoaderState_error_load,t,"")}}function u(e){y=null,S=null,D=null,p&&p.clear(),(e||_.type==v.type)&&_&&_.running&&_.close(),_=null}var l=r(3),d=(r(1),r(6)),f=r(2),p=r(45),g=r(4),m=r(49),v=r(7),y=null,S=null,b=null,D=null,T=-1,_=null,k="",w="";return{load:a,close:u,get url(){return k},get running(){return null!=D},get loadStage(){return w},set loadStage(e){w=e}}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e,t,r){if(!w){S=r,b=e,D=t,w=!0,_="";try{S.vip?""==S.key?(T=1,_=S.bossUrl.indexOf("?")==-1?S.bossUrl+"?rn="+Date.now():S.bossUrl+"&rn="+Date.now(),S.stateChangeFun.call(S,p.playState_loadState,{loadType:"authentication",activeType:"start",url:_}),d.info("dispatch [VIP KEY] sourceID : "+S.vid+" , url : "+_),g.addPBItem(m.dispatchKey_Cnt),y=new u(_,n,s)):(T=2,_=S.dispatchUrl.indexOf("?")==-1?S.dispatchUrl+"?rn="+Date.now():S.dispatchUrl+"&rn="+Date.now(),_.indexOf("pv=0.1")==-1&&(_+="&pv=0.1"),_+="&cross-domain=1",S.errIDCList.length>0&&(_+="&retry="+S.errIDCList.length.toString(),_+="&z="+S.errIDCList.toLocaleString().replace(/,/g,"|")),S.isAD||(v.preidc&&""!=v.preidc.idc&&v.preidc.speed>S.rate&&(_+="&pri_idc="+v.preidc.idc),d.info("dispatch [VIP START] sourceID : "+S.vid+" , url : "+_),f.p2p&&!S.onTracker&&(d.info("AND tracker Dispatch [START]"),_+="&id="+S.p2pID)),S.stateChangeFun.call(S,p.playState_loadState,{loadType:"dispatch",activeType:"start",url:_}),g.addPBItem(m.dispatch_Cnt),k=Date.now(),y=new c(_,n,s)):(T=2,_=S.dispatchUrl.indexOf("?")==-1?S.dispatchUrl+"?rn="+Date.now():S.dispatchUrl+"&rn="+Date.now(),_.indexOf("pv=0.1")==-1&&(_+="&pv=0.1"),_+="&cross-domain=1",S.errIDCList.length>0&&(_+="&retry="+S.errIDCList.length.toString(),_+="&z="+S.errIDCList.toLocaleString().replace(/,/g,"|")),S.isAD||(v.preidc&&""!=v.preidc.idc&&v.preidc.speed>S.rate&&(_+="&pri_idc="+v.preidc.idc),d.info("dispatch [NORMAL START] sourceID : "+S.vid),f.p2p&&!S.onTracker&&(d.info("AND tracker Dispatch [START]"),_+="&id="+S.p2pID)),S.stateChangeFun.call(S,p.playState_loadState,{loadType:"dispatch",activeType:"start",url:_}),g.addPBItem(m.dispatch_Cnt),k=Date.now(),y=new h(_,n,s))}catch(e){s("tryCatchError")}}}function n(e){if(1==T)g.addPBItem(m.dispatchKey_Done),"A00000"http://static.iqiyi.com/js/player_v1/res/20170713/==e.code?(S.stateChangeFun.call(S,p.playState_loadState,{loadType:"authentication",activeType:"done",url:_,data:e,duration:(Date.now()-k).toString()}),d.info("dispatch [VIP KEY DONE] sourceID : "+S.vid+" , url : "+_),S.key=e.data.t,o(),T=2,d.info("dispatch [VIP START] sourceID : "+S.vid+" , url : "+_),y=new c(S.dispatchUrl,n,s)):s("AuthenticationError");else if(2==T){g.addPBItem(m.dispatch_doneCount),g.addPBItem(m.dispatch_duration,Date.now()-k),d.info("dispatch [NORMAL / VIP DONE] data : "+JSON.stringify(e));var t=v.userInfo=e.t;if(v.userNetType=t.split("|")[0],v.userArea=t.split("|")[1].split("-")[0],v.userIP=t.split("|")[1].split("-")[1],S.ip=l.getPureIP(e.l),S.ws=e.hasOwnProperty("websock")&&("1"==e.websock||1==e.websock),S.idc=e.z,S.dataUrl=e.l,l.isDomain(S.ip)&&(S.ws=!1),S.stateChangeFun.call(S,p.playState_loadState,{loadType:"dispatch",activeType:"done",url:_,data:e,duration:(Date.now()-k).toString()}),f.p2p&&!S.isAD&&!S.onTracker&&e.hasOwnProperty("r")){var r=l.getPureIP(e.r),i=["http://static.iqiyi.com/js/player_v1/res/20170713/101.227.14.164"],a=["http://static.iqiyi.com/js/player_v1/res/20170713/101.227.14.164"];r="CNC"==v.userNetType?i[S.p2pID%i.length]:a[S.p2pID%a.length],d.info("AND tracker Dispatch [DONE] IP : "+r),S.setTrackerIP(r)}o(),b&&b.call(this)}}function s(e){o(),D&&D.call(this,e)}function o(e){T=0,w&&y&&(y.destroy(),y=null),w=!1,e&&(b=null,D=null)}var h=r(46),c=r(47),u=r(48),l=r(3),d=r(2),f=r(1),p=r(4),g=r(5),m=r(12),v=r(6),y=null,S=null,b=null,D=null,T=0,_="",k=0,w=!1;return{get url(){return _},start:a,clear:function(){o(!0)}}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,r){function i(e,t,r){function i(e){a.loader&&(a.destroy(),a.errFun.call(a,e))}var a=this;a.doneFun=t,a.errFun=r;var n=e;a.loader=new XMLHttpRequest,a.loader.responseType="json",a.loader.onreadystatechange=function(){if(0==a.loader.readyState);else if(1==a.loader.readyState);else if(2==a.loader.readyState);else if(3==a.loader.readyState);else if(200===a.loader.status)if(a.loader.response)if(a.loader.response.hasOwnProperty("l")){var e=JSON.parse(JSON.stringify(a.loader.response));a.destroy(),a.doneFun.call(this,e)}else i("responseHas`tProperty-l");else i("responseIsNull");else i("statusErr-"+a.loader.status)};try{a.loader.open("GET",n,!0),a.loader.send()}catch(e){i("tryCatchError")}}return i.prototype.destroy=function(){this.loader&&(this.loader.abort(),delete this.loader)},i}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,r){function i(e,t,r){function i(e){a.loader&&(a.destroy(),a.errFun.call(a,e))}var a=this;a.doneFun=t,a.errFun=r;var n=e;a.loader=new XMLHttpRequest,a.loader.responseType="json",a.loader.onreadystatechange=function(){if(0==a.loader.readyState);else if(1==a.loader.readyState);else if(2==a.loader.readyState);else if(3==a.loader.readyState);else if(200===a.loader.status)if(a.loader.response)if(a.loader.response.hasOwnProperty("l")){var e=JSON.parse(JSON.stringify(a.loader.response));a.destroy(),a.doneFun.call(this,e)}else i("responseHas`tProperty-l");else i("responseIsNull");else i("statusErr-"+a.loader.status)};try{a.loader.open("GET",n,!0),a.loader.send()}catch(e){i("tryCatchError")}}return i.prototype.destroy=function(){this.loader&&(this.loader.abort(),delete this.loader)},i}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,r){function i(e,t,r){function i(e){a.loader&&(a.destroy(),a.errFun.call(a,e))}var a=this;a.doneFun=t,a.errFun=r;var n=e;a.loader=new XMLHttpRequest,a.loader.responseType="json",a.loader.onreadystatechange=function(){if(0==a.loader.readyState);else if(1==a.loader.readyState);else if(2==a.loader.readyState);else if(3==a.loader.readyState);else if(200===a.loader.status)if(a.loader.response){var e=JSON.parse(JSON.stringify(a.loader.response));a.destroy(),a.doneFun.call(this,e)}else i("responseIsNull");else i("statusErr-"+a.loader.status)};try{a.loader.open("GET",n,!0),a.loader.send()}catch(e){i("tryCatchError")}}return i.prototype.destroy=function(){this.loader&&(this.loader.abort(),delete this.loader)},i}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e){m=e}function n(e){if(clearTimeout(b),b=0,D=0,S=null,w=0,y=e,!y||!y.ip||!y.path)return void m.call(null,"error","taskError");if(y.end==-1)p=[{begin:y.begin,end:8192}];else if(p=s(y.begin,y.end,Math.min(Math.max(1024*y.rate,32768),1048576)),0==p.length)return y=null,S=null,T&&T.readyState==WebSocket.OPEN&&(b=setTimeout(f,25e3)),void m.call(this,"done"http://static.iqiyi.com/js/player_v1/res/20170713/);y.ip==_&&T&&T.readyState==WebSocket.OPEN?(y&&m.call(null,"open"),d()):(v=!1,T&&(T.onopen=null,T.onclose=null,T.onerror=null,T.onmessage=null,T.close()),_=y.ip,k=y.path,T=new WebSocket("ws://"+_+"/ws"),T.binaryType="arraybuffer",T.onopen=o,T.onmessage=u,T.onerror=c,T.onclose=h)}function s(e,t,r){for(var i,a=[];e<t;)e+r<t?(i=e+r,a.push({begin:e,end:i}),e=i):(i=t,a.push({begin:e,end:i}),e=i);return a}function o(){y&&(m.call(null,"open"),d())}function h(){y&&(f(),m.call(null,"error","netClose"))}function c(){y&&(f(),m.call(null,"error","netError"))}function u(e){if(y){var t=new DataView(e.data);if(y.state=t.getUint16(0),0==y.state||2==y.state){v=!0;var r=t.getUint32(2);r>0&&(y.end==-1&&(y.end=r,p=s(S.end,y.end,Math.min(Math.max(1024*y.rate,32768),1048576))),y.data=new Uint8Array(e.data.slice(6)),y.range=S,m.call(null,"progress")),d()}else 1==y.state?(f(),m.call(null,"error","server")):3==y.state?(v=!0,y&&(D++,D<=2?w=setTimeout(l,1e3*D):(f(),m.call(null,"error","require")))):4==y.state?(f(),m.call(null,"error","sendFile")):5==y.state?(f(),m.call(null,"error","url")):6==y.state?(f(),m.call(null,"error","check")):(f(),m.call(null,"error","unknown"))}}function l(){y&&(p.unshift(S),g.warn("load [loop-source error] range : "+y.begin+"-"+y.end+" , sourceID : "+y.path),d())}function d(){p.length>0?v?(S=p.shift(),T.send(JSON.stringify({path:y.path,type:0,range:S.begin+"-"+S.end}))):T.send(JSON.stringify({url:y.url,type:0})):(y=null,S=null,b=setTimeout(f,25e3),m.call(null,"done"))}function f(){if(v=!1,T){T.onopen=null,T.onclose=null,T.onerror=null,T.onmessage=null;try{T.close()}catch(e){}T=null}y=null,S=null,p.length=0,clearTimeout(b),clearTimeout(w),w=0}var p,g=r(2),m=null,v=!1,y=null,S=null,b=0,D=0,T=null,_="",k="",w=0;return{init:a,load:n,close:f,get type(){return"websocket"},get running(){return null!=y}}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(){function e(e){return t(e)}function t(e){return l(r(u(e),8*e.length))}function r(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;for(var r=1732584193,i=-271733879,h=-1732584194,u=271733878,l=0;l<e.length;l+=16){var d=r,f=i,p=h,g=u;r=a(r,i,h,u,e[l+0],7,-680876936),u=a(u,r,i,h,e[l+1],12,-389564586),h=a(h,u,r,i,e[l+2],17,606105819),i=a(i,h,u,r,e[l+3],22,-1044525330),r=a(r,i,h,u,e[l+4],7,-176418897),u=a(u,r,i,h,e[l+5],12,1200080426),h=a(h,u,r,i,e[l+6],17,-1473231341),i=a(i,h,u,r,e[l+7],22,-45705983),r=a(r,i,h,u,e[l+8],7,1770035416),u=a(u,r,i,h,e[l+9],12,-1958414417),h=a(h,u,r,i,e[l+10],17,-42063),i=a(i,h,u,r,e[l+11],22,-1990404162),r=a(r,i,h,u,e[l+12],7,1804603682),u=a(u,r,i,h,e[l+13],12,-40341101),h=a(h,u,r,i,e[l+14],17,-1502002290),i=a(i,h,u,r,e[l+15],22,1236535329),r=n(r,i,h,u,e[l+1],5,-165796510),u=n(u,r,i,h,e[l+6],9,-1069501632),h=n(h,u,r,i,e[l+11],14,643717713),i=n(i,h,u,r,e[l+0],20,-373897302),r=n(r,i,h,u,e[l+5],5,-701558691),u=n(u,r,i,h,e[l+10],9,38016083),h=n(h,u,r,i,e[l+15],14,-660478335),i=n(i,h,u,r,e[l+4],20,-405537848),r=n(r,i,h,u,e[l+9],5,568446438),u=n(u,r,i,h,e[l+14],9,-1019803690),h=n(h,u,r,i,e[l+3],14,-187363961),i=n(i,h,u,r,e[l+8],20,1163531501),r=n(r,i,h,u,e[l+13],5,-1444681467),u=n(u,r,i,h,e[l+2],9,-51403784),h=n(h,u,r,i,e[l+7],14,1735328473),i=n(i,h,u,r,e[l+12],20,-1926607734),r=s(r,i,h,u,e[l+5],4,-378558),u=s(u,r,i,h,e[l+8],11,-2022574463),h=s(h,u,r,i,e[l+11],16,1839030562),i=s(i,h,u,r,e[l+14],23,-35309556),r=s(r,i,h,u,e[l+1],4,-1530992060),u=s(u,r,i,h,e[l+4],11,1272893353),h=s(h,u,r,i,e[l+7],16,-155497632),i=s(i,h,u,r,e[l+10],23,-1094730640),r=s(r,i,h,u,e[l+13],4,681279174),u=s(u,r,i,h,e[l+0],11,-358537222),h=s(h,u,r,i,e[l+3],16,-722521979),i=s(i,h,u,r,e[l+6],23,76029189),r=s(r,i,h,u,e[l+9],4,-640364487),u=s(u,r,i,h,e[l+12],11,-421815835),h=s(h,u,r,i,e[l+15],16,530742520),i=s(i,h,u,r,e[l+2],23,-995338651),r=o(r,i,h,u,e[l+0],6,-198630844),u=o(u,r,i,h,e[l+7],10,1126891415),h=o(h,u,r,i,e[l+14],15,-1416354905),i=o(i,h,u,r,e[l+5],21,-57434055),r=o(r,i,h,u,e[l+12],6,1700485571),u=o(u,r,i,h,e[l+3],10,-1894986606),h=o(h,u,r,i,e[l+10],15,-1051523),i=o(i,h,u,r,e[l+1],21,-2054922799),r=o(r,i,h,u,e[l+8],6,1873313359),u=o(u,r,i,h,e[l+15],10,-30611744),h=o(h,u,r,i,e[l+6],15,-1560198380),i=o(i,h,u,r,e[l+13],21,1309151649),r=o(r,i,h,u,e[l+4],6,-145523070),u=o(u,r,i,h,e[l+11],10,-1120210379),h=o(h,u,r,i,e[l+2],15,718787259),i=o(i,h,u,r,e[l+9],21,-343485551),r=c(r,d),i=c(i,f),h=c(h,p),u=c(u,g)}return[r,i,h,u]}function i(e,t,r,i,a,n){return c(h(c(c(t,e),c(i,n)),a),r)}function a(e,t,r,a,n,s,o){return i(t&r|~t&a,e,t,n,s,o)}function n(e,t,r,a,n,s,o){return i(t&a|r&~a,e,t,n,s,o)}function s(e,t,r,a,n,s,o){return i(t^r^a,e,t,n,s,o)}function o(e,t,r,a,n,s,o){return i(r^(t|~a),e,t,n,s,o)}function h(e,t){return e<<t|e>>>32-t}function c(e,t){var r=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(r>>16);return i<<16|65535&r}function u(e){for(var t=[],r=255,i=0;i<8*e.length;i+=8)t[i>>5]|=(e.charCodeAt(i/8)&r)<<i%32;return t}function l(e){for(var t="",r="0123456789abcdef",i=0;i<4*e.length;i++)t+=r.charAt(e[i>>2]>>i%4*8+4&15)+r.charAt(e[i>>2]>>i%4*8&15);return t}return{calculate:e}}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))},function(e,t,r){var i;i=function(e,t,i){function a(e,t){this.order=-1,this.videoInfo=e,this.stateChangeFun=t,this.isAD=!0,this.vip=!1,this.rate=76,this.vid=e.vid,this.index=e.index,this.size=-1,this.cePos=0,this.showStartTime=0,this.realStartTime=0,this.realEndTime=15e3,this.realStartPos=-1,this.lastCEPos=0,this.parseTime=0,this.parsePos=0;var r=this.dispatchUrl=e.getUrl(),i=r.indexOf(".f4v"),n=r.lastIndexOf("/",i);this.alias=this.fragmentName=this.sourceID=r.slice(n+1,i);var s=o.getPureIP(r),c=r.indexOf(s),u=r.indexOf(".f4v");this.path=r.slice(c+s.length,u+4),this.data=new Uint8Array(2097152),this.flvInfo=null,""==a.ip&&""==a.idc&&null!=h.preidc&&(a.ip=h.preidc.ip,a.idc=h.preidc.idc,a.ws=h.preidc.ws)}var n=r(16),s=r(4),o=(r(2),r(3)),h=r(6),c=r(43),u=null;return a.idc="",a.ip="",a.ws=!1,a.errIDCList=[],a.prototype.pushData=function(e,t){if(this.data.set(e,t),this.cePos+=e.byteLength,!this.flvInfo&&this.cePos>=8192){if(u=this.data.subarray(0,8192),this.flvInfo=n.pickUpHead(u),!this.flvInfo)return this.stateChange(s.dataState_error_parseHead,""),!0;this.realEndTime=Math.ceil(1e3*this.flvInfo.info.duration);for(var r=this.flvInfo.info.keyframes.times,i=0;i<r.length;i++)r[i]=1e3*r[i];if(this.realStartPos=this.parsePos=this.flvInfo.info.keyframes.filepositions[1],this.size==-1&&(this.size=this.flvInfo.info.filesize,this.data.byteLength<this.size)){var a=this.data.subarray(0,this.cePos);this.data=new Uint8Array(this.size),this.data.set(a,0)}this.rate=Math.ceil(this.size/this.realEndTime)}if(this.flvInfo){if(this.cePos-this.parsePos<8192&&this.cePos<this.size)return!0;u=this.data.subarray(this.parsePos,this.cePos);var o=n.check(u);if(!o.correct)throw this.stateChange(s.dataState_error_parseData,""),"check flv error message : "+o.message;o.position>0&&(this.parsePos+=o.position),o.endTime>0&&(this.parseTime=o.endTime),u=null}return!0},a.prototype.loadData=function(){if(this.size!=-1){if(this.cePos>=this.size)return;c.load(this,[{begin:this.cePos,end:this.size}])}else c.load(this,[{begin:0,end:-1}])},a.prototype.read=function(e){if(this.data&&!e.fragmentEOF&&this.flvInfo){if(e.readPosition==-1&&(e.readPosition=this.flvInfo.info.keyframes.filepositions[1],e.readTime=0),e.readPosition>=this.size)return e.fragmentEOF=!0,!0;var t=this.getNextIDRByPos(e.readPosition);if(!(this.parsePos>=e.readPosition))return e.keyFrame=!1,!1;if(this.parsePos<t.position){if(e.keyFrame=!1,!(t.position-this.parsePos>=131072))return!1;t.position=this.parsePos}else e.keyFrame=!0;if(t.position>e.readPosition)return u=this.data.subarray(e.readPosition,t.position),e.fragmentEOF=t.position>=this.size,e.packetFMP4(this,u,this.realStartPos==e.readPosition)}return!1},a.prototype.getNextIDRByPos=function(e){for(var t=this.flvInfo.info.keyframes.filepositions,r=this.flvInfo.info.keyframes.times,i=0;i<t.length;i++)if(e<t[i]){if(0==i&&r.length>0&&(i=1),i==r.length-1)break;return{position:t[i],time:r[i]}}return{position:this.size,time:this.endTime}},a.prototype.stateChange=function(e,t){this.stateChangeFun.call(this,e,t)},a.prototype.destroy=function(){delete this.data},a.prototype.__defineGetter__("created",function(){return!0}),a.prototype.__defineGetter__("approachEnd",function(){return!1}),a.prototype.__defineSetter__("state",function(e){}),a.prototype.__defineGetter__("ceTime",function(){return this.parseTime}),a.prototype.__defineGetter__("lastCEPos",function(){return this.cePos}),a.prototype.__defineGetter__("done",function(){return this.size!=-1&&null!=this.flvInfo&&this.cePos>=this.size}),a.prototype.checkTask=function(){return this.done?[]:this.size!=-1?[{begin:this.cePos,end:this.size}]:[{begin:0,end:-1}]},a.prototype.p2pPreLoad=function(){},a.prototype.p2pStopPreLoad=function(){},a.prototype.p2pLoad=function(){},a.prototype.reset=function(e,t,r){},a.prototype.toDataString=function(e){return"AD-data-AD : "+this.order+"[ "+this.cePos+" / "+this.size+"] duration : "+this.realEndTime},a.prototype.checkCreateSegment=function(e){},a.prototype.__defineGetter__("dataUrl",function(){if(""==a.ip||""==a.idc)return"";var e=o.getPureIP(this.dispatchUrl);return this.dispatchUrl.replace(e,a.ip)}),a.prototype.__defineSetter__("dataUrl",function(e){""==e&&(a.ip="",a.idc="")}),a.prototype.__defineGetter__("describe",function(){return"[AD]"}),a.prototype.__defineSetter__("ip",function(e){a.ip=e}),a.prototype.__defineGetter__("ip",function(){return a.ip}),a.prototype.__defineSetter__("idc",function(e){a.idc=e}),a.prototype.__defineGetter__("idc",function(){return a.idc}),a.prototype.__defineSetter__("ws",function(e){a.ws=e}),a.prototype.__defineGetter__("ws",function(){return a.ws}),a.prototype.__defineSetter__("errIDCList",function(e){a.errIDCList=e}),a.prototype.__defineGetter__("errIDCList",function(){return a.errIDCList}),a}.call(t,r,t,e),!(void 0!==i&&(e.exports=i))}]);